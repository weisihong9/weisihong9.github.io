<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>WeiSH&#39;s BLOG</title>
  
  <subtitle>MaTRix</subtitle>
  <link href="https://weisihong9.github.io/atom.xml" rel="self"/>
  
  <link href="https://weisihong9.github.io/"/>
  <updated>2026-01-04T03:43:21.970Z</updated>
  <id>https://weisihong9.github.io/</id>
  
  <author>
    <name>weisihong</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>NeuroSignal Preprocessor</title>
    <link href="https://weisihong9.github.io/2025/12/11/NeuroSignalPreprocessor/"/>
    <id>https://weisihong9.github.io/2025/12/11/NeuroSignalPreprocessor/</id>
    <published>2025-12-11T03:49:43.000Z</published>
    <updated>2026-01-04T03:43:21.970Z</updated>
    
    <content type="html"><![CDATA[<h1 id="neurosignal-preprocessor-使用说明"><a class="markdownIt-Anchor" href="#neurosignal-preprocessor-使用说明"></a> NeuroSignal Preprocessor 使用说明</h1><hr /><h2 id="1-软件简介"><a class="markdownIt-Anchor" href="#1-软件简介"></a> 1. 软件简介</h2><p><strong>NeuroSignal Preprocessor</strong> 是一款用于 <strong>EEG / fNIRS / EMG</strong> 神经信号数据的桌面预处理与特征提取软件。</p><p>本软件主要面向入门脑科学领域的科研人员，提供简洁的图形化界面，支持从数据加载、预处理到特征提取的完整流程，<strong>无需安装 Python 环境</strong>，双击即可运行。</p><ul><li>本软件由作者在科研实践中自主开发并持续维护，主要用于神经信号数据预处理与特征分析研究。</li><li>软件功能仍在不断完善中，由于实验条件与数据差异，在特定场景下可能存在未覆盖的边界情况。</li><li><strong>软件输出结果仅供科研与方法探索参考，不构成任何临床或商业用途的保证。</strong></li><li>相关分析结果应结合具体实验设计与数据特性进行合理解释。</li><li>如在使用过程中发现问题或有改进建议，欢迎反馈以协助改进。<br />下载链接🔗：通过网盘分享的文件：NeuroSignalPreprocessor.zip<br />链接: <a href="https://pan.baidu.com/s/1Hz__D7FExQeWtObw0W0dwA">https://pan.baidu.com/s/1Hz__D7FExQeWtObw0W0dwA</a> 提取码: 3hnt</li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512311226899.png" alt="" /></p><hr /><h2 id="2-系统要求与运行环境"><a class="markdownIt-Anchor" href="#2-系统要求与运行环境"></a> 2. 系统要求与运行环境</h2><h3 id="21-操作系统"><a class="markdownIt-Anchor" href="#21-操作系统"></a> 2.1 操作系统</h3><ul><li>Windows 10 / Windows 11（<strong>64 位</strong>）</li></ul><h3 id="22-硬件建议"><a class="markdownIt-Anchor" href="#22-硬件建议"></a> 2.2 硬件建议</h3><ul><li>内存：8 GB（推荐 16 GB 及以上）</li><li>磁盘空间：至少 2 GB 可用空间</li></ul><h3 id="23-必要运行库"><a class="markdownIt-Anchor" href="#23-必要运行库"></a> 2.3 必要运行库</h3><p>本软件依赖以下系统运行库：</p><ul><li><strong>Microsoft Visual C++ Redistributable 2015–2022（x64）</strong></li></ul><p>若软件无法启动或启动时报错，请优先确认已安装该运行库。</p><hr /><h2 id="3-安装与启动方式"><a class="markdownIt-Anchor" href="#3-安装与启动方式"></a> 3. 安装与启动方式</h2><h3 id="31-文件结构说明"><a class="markdownIt-Anchor" href="#31-文件结构说明"></a> 3.1 文件结构说明</h3><p>解压后目录结构如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">NeuroSignalPreprocessor</span>/↩︎  </span><br><span class="line">├─ <span class="title class_">NeuroSignalPreprocessor</span>.<span class="property">exe</span>↩︎ </span><br><span class="line">├─ _internal/↩︎ </span><br></pre></td></tr></table></figure><p>⚠ <strong>请勿单独移动或复制 exe 文件</strong>，必须保留整个文件夹结构，否则软件将无法运行。</p><h3 id="32-启动方式"><a class="markdownIt-Anchor" href="#32-启动方式"></a> 3.2 启动方式</h3><ol><li>进入 <code>NeuroSignalPreprocessor</code> 文件夹</li><li>双击 <code>NeuroSignalPreprocessor.exe</code></li><li>软件启动后将显示主界面</li></ol><hr /><h2 id="4-软件界面说明"><a class="markdownIt-Anchor" href="#4-软件界面说明"></a> 4. 软件界面说明</h2><p>启动后进入主界面，包含以下三个模块：</p><ul><li><strong>EEG</strong>：脑电信号预处理与特征提取</li><li><strong>fNIRS</strong>：近红外脑功能成像信号处理</li><li><strong>EMG</strong>：肌电信号处理</li></ul><p>点击对应模块即可进入功能页面。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512301919741.png" alt="" /></p><hr /><h2 id="5-eeg模块使用说明"><a class="markdownIt-Anchor" href="#5-eeg模块使用说明"></a> 5. EEG模块使用说明</h2><h3 id="51-模块设计理念"><a class="markdownIt-Anchor" href="#51-模块设计理念"></a> 5.1. 模块设计理念</h3><p>EEG 模块基于标准脑电信号处理流程设计，整体思路与 <strong>MNE-Python / EEGLAB</strong> 等主流科研工具保持一致，强调：</p><ul><li><strong>流程可控</strong></li><li><strong>参数可解释</strong></li><li><strong>人工干预与自动处理结合</strong></li><li><strong>结果可复现</strong></li></ul><p>推荐预处理流程如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Load</span> <span class="title class_">Data</span></span><br><span class="line">→ <span class="title class_">Mark</span> <span class="title class_">Bad</span> <span class="title class_">Channels</span></span><br><span class="line">→ <span class="title class_">Filter</span></span><br><span class="line">→ <span class="variable constant_">ICA</span></span><br><span class="line">→ <span class="title class_">Re</span>-reference</span><br><span class="line">→ <span class="title class_">Interpolate</span></span><br><span class="line">→ <span class="title class_">Epoch</span> / <span class="title class_">Mark</span></span><br><span class="line">→ <span class="title class_">Feature</span> <span class="title class_">Extraction</span></span><br><span class="line">→ <span class="title class_">Save</span></span><br></pre></td></tr></table></figure><hr /><h3 id="52-数据载入load-data"><a class="markdownIt-Anchor" href="#52-数据载入load-data"></a> 5.2. 数据载入（Load Data）</h3><h4 id="521-数据载入"><a class="markdownIt-Anchor" href="#521-数据载入"></a> 5.2.1 数据载入</h4><p>在 <strong>Load Data</strong> 页面中，用户可加载原始 EEG 数据文件。<br />系统基于 MNE 框架读取数据，并保持数据为 <strong>raw 状态</strong>。<br /><strong>通过点击 <code>Browse</code> 按钮打开文件选择对话框，选择目标 EEG 数据文件并确认，即可完成数据载入。</strong></p><h4 id="522-支持格式"><a class="markdownIt-Anchor" href="#522-支持格式"></a> 5.2.2 支持格式</h4><ul><li><code>.set</code>（EEGLAB）</li><li><code>.fif</code>（MNE）</li><li><code>.edf / .bdf</code></li><li><code>.vhdr</code>（BrainVision）</li></ul><h4 id="523-数据状态指示"><a class="markdownIt-Anchor" href="#523-数据状态指示"></a> 5.2.3 数据状态指示</h4><p>加载成功后，界面将显示：</p><ul><li>当前数据状态（raw）</li><li>EEG 通道数量</li><li>信号采样频率和时长</li><li>通道位置</li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512301930120.png" alt="" /><br /><strong>通过点击 <code>Preview PSD</code> 按钮可查看信号的功率谱密度</strong></p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512301935974.png" alt="" /></p><hr /><h3 id="53-eeg预处理"><a class="markdownIt-Anchor" href="#53-eeg预处理"></a> 5.3. EEG预处理</h3><h4 id="531-坏道标记bad-channels"><a class="markdownIt-Anchor" href="#531-坏道标记bad-channels"></a> 5.3.1 坏道标记（Bad Channels）</h4><p>坏道（Bad Channels）是 EEG 预处理中必须处理的问题，常见原因包括：</p><ul><li>电极脱落</li><li>高阻抗</li><li>持续高噪声</li><li>运动伪迹</li></ul><p>在后续滤波、ICA 和重参考前，<strong>明确坏道列表至关重要</strong>。</p><p>在 <strong>Mark Bad Channels</strong> 页面中，用户可：</p><ul><li>预览原始信号（Preview Raw）</li><li>手动选择通道并标记为 bad</li><li>撤销（Undo）操作</li></ul><p>选择坏道（Bad Channels）的方式主要有以下两种：</p><ol><li><p><strong>基于原始信号可视化标记</strong></p><ul><li>点击 <strong><code>Preview Raw</code></strong> 按钮，系统将弹出原始 EEG 信号浏览窗口</li><li>在信号窗口中，用户可通过点击通道名称选择需要标记为坏道的通道</li><li>被选中的通道将以灰色显示以示区分</li><li>确认选择后，关闭信号窗口，所选通道将被自动记录为坏道</li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512301942623.png" alt="" /></p></li><li><p><strong>基于通道列表的手动标记</strong></p><ul><li>用户亦可在主界面的通道列表中直接选择需要标记的通道，</li><li>点击 <strong><code>Add to bads</code></strong> 按钮后，所选通道将被加入坏道列表，</li><li>并在界面下方的 <strong><code>Current bads</code></strong> 区域中实时显示。</li><li>如需撤销已标记的坏道，可点击 <strong><code>Undo</code></strong> 按钮以恢复至上一步状态。<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512301946037.png" alt="" /><br />系统会将坏道信息写入 <code>raw.info['bads']</code>，，并在后续滤波、ICA、重参考及插值过程中自动继承。</li></ul></li></ol><h4 id="532-eog-通道标记-mark-eog"><a class="markdownIt-Anchor" href="#532-eog-通道标记-mark-eog"></a> 5.3.2 EOG 通道标记 (Mark EOG)</h4><p>通过 <strong>Mark EOG</strong> 功能，可指定眼电通道，用于：</p><ul><li>ICA 中自动识别眼动伪迹成分</li><li>提高伪迹去除准确性</li></ul><p>在数据加载阶段，系统将对通道类型进行自动检测，并完成以下操作：</p><ul><li><p><strong>自动识别眼电通道</strong><br />系统将在数据加载完成后自动识别可能的眼电通道，并将其加入 <strong><code>Current EOG</code></strong> 列表中，供后续处理流程使用。</p></li><li><p><strong>自动识别结果的人工修正</strong><br />若自动识别的眼电通道与实际通道类型不一致，用户可在通道列表中选中对应通道；<br />点击 <strong><code>Set selected back to EEG</code></strong> 按钮，将该通道恢复为普通 EEG 通道，从而撤销眼电标记。</p></li><li><p><strong>手动补充眼电通道</strong><br />对于未被系统自动识别的眼电通道，用户可在通道列表中手动选中相应通道;<br />点击 <strong><code>Set selected to EOG</code></strong> 将其标记为 EOG 通道，使其加入 <strong><code>Current EOG</code></strong> 列表。</p></li></ul><p>所有已确认的 EOG 通道信息将被用于 ICA 阶段的伪迹成分识别与分类，以辅助眼动伪迹的自动检测与去除。</p><h4 id="533-滤波filter"><a class="markdownIt-Anchor" href="#533-滤波filter"></a> 5.3.3 滤波（FILTER）</h4><h5 id="1支持类型"><a class="markdownIt-Anchor" href="#1支持类型"></a> 1）支持类型</h5><ul><li><strong>带通滤波（Band-pass）</strong></li><li><strong>陷波滤波（Notch）</strong></li></ul><h5 id="2常用参数建议经验值"><a class="markdownIt-Anchor" href="#2常用参数建议经验值"></a> 2）常用参数建议（经验值）</h5><table><thead><tr><th>场景</th><th>低频 (Hz)</th><th>高频 (Hz)</th></tr></thead><tbody><tr><td>ERP</td><td>0.1</td><td>30</td></tr><tr><td>频谱分析</td><td>1</td><td>40</td></tr><tr><td>ICA 前处理</td><td>1</td><td>40</td></tr></tbody></table><p>陷波滤波（Notch Filter）通常用于去除电源工频干扰，其常用设置如下：</p><ul><li><strong>50 Hz</strong>：适用于中国、欧洲等使用 50 Hz 市电频率的地区</li><li><strong>60 Hz</strong>：适用于北美等使用 60 Hz 市电频率的地区</li></ul><p>在完成滤波参数设置后，点击 <strong><code>Apply FILTER</code></strong> 按钮以执行滤波操作。<br />滤波成功后，界面下方将显示本次滤波所使用的参数信息，并提示 <strong><code>Filter applied successfully</code></strong>，以确认滤波过程已顺利完成。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302006007.png" alt="" /></p><h4 id="534-独立成分分析ica"><a class="markdownIt-Anchor" href="#534-独立成分分析ica"></a> 5.3.4 独立成分分析：ICA</h4><h5 id="1目的"><a class="markdownIt-Anchor" href="#1目的"></a> 1）目的</h5><p>独立成分分析（Independent Component Analysis, ICA）是一种常用的盲源分离方法，用于将多通道 EEG 信号分解为若干统计独立的成分，从而实现对生理与非生理伪迹的识别与剔除。</p><p>在本软件中，ICA 主要用于分离和处理以下常见伪迹来源：</p><ul><li><strong>眼动伪迹（EOG）</strong>：眨眼、眼球转动引起的低频大幅度信号</li><li><strong>心电伪迹（ECG）</strong>：心跳相关的周期性成分</li><li><strong>肌电伪迹（EMG）</strong>：高频、局部化的肌肉活动信号</li><li><strong>高频噪声</strong>：与真实脑活动无关的随机或系统性噪声</li></ul><h5 id="2ica-参数说明"><a class="markdownIt-Anchor" href="#2ica-参数说明"></a> 2）ICA 参数说明</h5><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302032141.png" alt="" /></p><h6 id="n_components成分数量"><a class="markdownIt-Anchor" href="#n_components成分数量"></a> <strong>n_components（成分数量）</strong></h6><p>用于指定 ICA 分解时保留的成分数量或数据方差比例。<br />常见设置方式包括：</p><ul><li><p><strong>0.95 / 0.99（推荐）</strong><br />表示保留 <strong>95% / 99% 的数据方差</strong>，系统将根据数据自动确定对应的 ICA 成分数量。<br />该方式在保证主要信号信息的同时，有助于减少噪声与过拟合，适用于大多数 EEG 数据分析场景。</p></li><li><p><strong>整数值（如 20、30、50）</strong><br />表示固定提取指定数量的 ICA 成分。<br />适用于通道数量固定、对 ICA 成分数量有明确经验或实验要求的情况。</p></li></ul><blockquote><p><strong>使用建议</strong>：<br />若不确定应提取多少个成分，建议优先使用 <strong>0.95</strong> 或 <strong>0.99</strong> 作为经验设置。</p></blockquote><hr /><h6 id="methodica-算法"><a class="markdownIt-Anchor" href="#methodica-算法"></a> <strong>method（ICA 算法）</strong></h6><p>用于指定执行 ICA 分解所采用的算法类型。</p><ul><li><strong>fastica（默认）</strong><br />一种计算效率高、在 EEG 数据分析中应用广泛的 ICA 算法，<br />在大多数常规预处理任务中能够提供稳定可靠的分解结果。</li></ul><hr /><h6 id="random_state随机种子"><a class="markdownIt-Anchor" href="#random_state随机种子"></a> <strong>random_state（随机种子）</strong></h6><p>用于控制 ICA 算法中的随机初始化过程。</p><ul><li>设置固定的 <code>random_state</code>（如 97），<br />可保证在相同数据与参数条件下多次运行 ICA 得到一致的结果，<br />有助于提高分析流程的<strong>可复现性</strong>与<strong>科研一致性</strong>。</li></ul><hr /><h6 id="参数设置建议"><a class="markdownIt-Anchor" href="#参数设置建议"></a> <strong>参数设置建议</strong></h6><ul><li><p><strong>常规预处理 / 初次使用</strong></p><ul><li><code>n_components = 0.95</code></li><li><code>method = fastica</code></li><li><code>random_state</code> 保持默认值</li></ul></li><li><p><strong>需要严格复现实验结果</strong></p><ul><li>固定 <code>random_state</code> 数值</li></ul></li><li><p><strong>对 ICA 成分数量有明确经验</strong></p><ul><li>使用整数形式的 <code>n_components</code></li></ul></li></ul><h5 id="3-执行-ica-分解fit-ica"><a class="markdownIt-Anchor" href="#3-执行-ica-分解fit-ica"></a> 3） 执行 ICA 分解（Fit ICA）</h5><ul><li>点击 <strong><code>Fit ICA</code></strong> 按钮后，系统将在当前已完成滤波与坏道标记的数据基础上执行 ICA 分解。</li><li>ICA 拟合完成后，系统将自动弹出 ICA 成分可视化窗口，包括：<ul><li><strong>成分空间分布（头皮地形图, topography）</strong></li><li><strong>成分时间序列（ICA sources）</strong><br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302033307.png" alt="" /><br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302035188.png" alt="" /><br />这些可视化结果用于辅助用户判断各独立成分的物理与生理意义。</li></ul></li></ul><h5 id="4ica-成分判别与选择"><a class="markdownIt-Anchor" href="#4ica-成分判别与选择"></a> 4）ICA 成分判别与选择</h5><p>在 ICA 成分窗口中，用户可基于以下信息对成分进行判别：</p><ul><li>成分时间序列的波形特征（如眨眼相关的尖峰或缓慢漂移）</li><li>成分头皮分布特征（如额区主导的眼动模式）</li><li>与 EOG 通道的相关性（若已正确设置 EOG 通道）</li></ul><h6 id="成分选择方式"><a class="markdownIt-Anchor" href="#成分选择方式"></a> 成分选择方式：</h6><ul><li>点击需要剔除的 ICA 成分，对应成分将被高亮/置灰标记</li><li>确认选择后，关闭成分窗口</li><li>被选中的成分编号将显示在主界面的 <strong><code>Excluded comps</code></strong> 信息区域中<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302036065.png" alt="" /><br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302036074.png" alt="" /></li></ul><h5 id="5编辑已选择的成分edit-excluded-comps"><a class="markdownIt-Anchor" href="#5编辑已选择的成分edit-excluded-comps"></a> 5）编辑已选择的成分（Edit excluded comps）</h5><ul><li>若需对已选择的剔除成分进行修改，可点击 <strong><code>Edit excluded comps</code></strong> 按钮</li><li>系统将弹出成分列表窗口，用户可：<ul><li>勾选或取消勾选需要剔除的 ICA 成分</li><li>保存更新后的剔除列表</li></ul></li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302037043.png" alt="" /></p><h5 id="6应用-ica-去伪迹apply-ica"><a class="markdownIt-Anchor" href="#6应用-ica-去伪迹apply-ica"></a> 6）应用 ICA 去伪迹（Apply ICA）</h5><ul><li>在确认需要剔除的成分后，点击 <strong><code>Apply ICA (exclude selected comps)</code></strong> 按钮</li><li>系统将基于所选成分，对原始数据进行重构并移除对应伪迹成分</li><li>ICA 应用完成后，系统将自动弹出结果可视化窗口，用于对去伪迹效果进行直观评估。</li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302043864.png" alt="" /><br />该可视化窗口通常包括以下内容：</p><ul><li><p><strong>原始信号与清理后信号对比</strong><br />以不同颜色显示 ICA 应用前（如红色）与应用后（如黑色）的 EEG 信号，用于直观观察伪迹去除效果。</p></li><li><p><strong>全局场功率（Global Field Power, GFP）变化</strong><br />对比清理前后 EEG 的整体能量分布变化，辅助评估大幅度伪迹是否得到有效抑制。</p></li><li><p><strong>跨通道平均信号对比</strong><br />展示所有 EEG 通道平均信号在 ICA 应用前后的变化趋势，以判断整体信号稳定性是否得到改善。</p></li></ul><p>通过上述可视化结果，用户可综合判断 ICA 成分剔除是否合理，在确认结果满意后，可继续执行后续的重参考、坏道插值或 epoch 切分等处理流程。</p><h5 id="7科研使用建议与注意事项"><a class="markdownIt-Anchor" href="#7科研使用建议与注意事项"></a> 7）科研使用建议与注意事项</h5><ul><li>建议在 <strong>完成滤波与坏道标记之后</strong> 再执行 ICA</li><li>ICA 成分剔除应结合自动辅助结果与人工判断，避免过度去除真实脑信号</li><li>推荐记录每次 ICA 使用的参数与被剔除成分编号，以保证分析过程的可复现性</li></ul><h4 id="535-重参考re-reference"><a class="markdownIt-Anchor" href="#535-重参考re-reference"></a> 5.3.5 重参考（Re-reference）</h4><p>重参考用于重新定义 EEG 信号的参考基准，对信号幅值分布与空间拓扑具有重要影响。<br />本软件支持以下两种常用重参考方式：</p><ul><li><p><strong>平均参考（Average Reference）</strong><br />将所有有效 EEG 通道的平均信号作为参考基准，<br />有助于减少单一参考电极带来的偏置，适用于通道分布较为均匀的高密度 EEG 数据。</p></li><li><p><strong>指定参考通道（Custom Reference）</strong><br />选择一个或多个特定通道作为参考基准，<br />适用于实验范式中已明确参考电极位置或需与既往研究保持一致的情况。</p></li></ul><p>确认参考方式后，点击 <strong><code>Apply Reference</code></strong> 按钮以应用重参考操作。<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302049949.png" alt="" /></p><h4 id="536-坏道插值interpolate"><a class="markdownIt-Anchor" href="#536-坏道插值interpolate"></a> 5.3.6 坏道插值（Interpolate）</h4><p>坏道插值用于对已标记的坏道进行空间重建，以减少通道缺失对数据完整性和空间分析的影响。</p><ul><li>插值基于电极空间位置与头模型信息，利用邻近通道信号对坏道进行估计重建</li><li>该操作有助于在保留整体空间拓扑结构的同时，降低因坏道剔除带来的数据损失</li></ul><p><strong>Reset bads after interpolation（可选）</strong><br />该选项用于控制插值完成后，原先标记为坏道（bad channels）的通道状态是否重置。</p><ul><li><strong>勾选该选项</strong>：<br />插值完成后，已插值重建的通道将被从坏道列表中移除，并重新作为有效 EEG 通道参与后续分析。</li><li><strong>未勾选该选项</strong>：<br />插值完成后，通道信号已被重建，但其坏道标记将被保留，在后续分析中仍会被视为原始坏道，仅用于保持处理记录的可追溯性。<br />该设置不会影响插值本身的计算结果，仅影响通道在后续流程中的标记状态。</li></ul><p>确认无误后点击 <strong><code>Interpolate bads</code></strong> 按钮以执行插值操作。</p><h2 id=""><a class="markdownIt-Anchor" href="#"></a> <img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302054849.png" alt="" /></h2><h4 id="537-保存结果"><a class="markdownIt-Anchor" href="#537-保存结果"></a> 5.3.7 保存结果</h4><p>预处理完成后，可将当前处理状态下的数据保存到本地文件。</p><ul><li>支持保存为 <strong>FIF（<code>.fif</code>）</strong>、<strong>EDF（<code>.edf</code>）</strong> 或 <strong>CSV（channels × time）</strong> 等格式，具体格式可在界面中选择。</li><li>保存操作仅作用于当前处理后的数据副本，<strong>不会修改原始数据文件</strong>。</li></ul><p>确认保存格式后，点击 <strong><code>Save current data</code></strong> 按钮即可完成数据导出。<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302102409.png" alt="" /></p><hr /><h3 id="54-特征提取"><a class="markdownIt-Anchor" href="#54-特征提取"></a> 5.4 特征提取</h3><p><strong>当前支持特征类型</strong></p><ul><li>时域特征</li><li>频域特征</li><li>功能连接特征</li></ul><h4 id="541-epoch-事件标记epoch-mark"><a class="markdownIt-Anchor" href="#541-epoch-事件标记epoch-mark"></a> 5.4.1 Epoch / 事件标记（Epoch / Mark）</h4><p>该模块用于将连续 EEG 信号切分为与事件（刺激/标记）相关的时间片段（epochs），以支持后续的事件相关分析。</p><h5 id="1-支持模式"><a class="markdownIt-Anchor" href="#1-支持模式"></a> 1) 支持模式</h5><ul><li><strong>连续数据模式</strong>：不进行事件切分，保留连续信号结构。</li><li><strong>按标记切分 Epoch</strong>：基于数据采集过程中记录的事件标记（marks / annotations）构建 epochs。</li></ul><h5 id="2-按-mark-切分-epoch"><a class="markdownIt-Anchor" href="#2-按-mark-切分-epoch"></a> 2) 按 Mark 切分 Epoch</h5><p>在选择 <strong>“按 mark 切 epoch”</strong> 模式后，系统将以表格形式列出当前数据中检测到的事件标记，包括各标记的编号及出现次数。</p><p>用户可进行以下设置：</p><ul><li><strong>Mark 来源</strong>：选择事件标记来源（如 Annotations）</li><li><strong>时间窗设置</strong>：<ul><li><code>tmin</code>：事件前时间（秒）</li><li><code>tmax</code>：事件后时间（秒）</li></ul></li><li><strong>基线校正（baseline）</strong>：设置基线区间或选择不进行基线校正</li></ul><h5 id="3-构建-epochs"><a class="markdownIt-Anchor" href="#3-构建-epochs"></a> 3) 构建 Epochs</h5><ul><li>单击选中<strong>表格</strong>中需要分析的事件标记（mark）</li><li>点击 <strong><code>构建 epochs</code></strong> 按钮执行切分操作</li><li>构建成功后，界面下方将显示 epoch 状态信息，包括：<ul><li>是否已成功构建</li><li>epoch 数量（<code>n_epochs</code>）</li><li>当前所选事件标记编号</li></ul></li></ul><p>该结果可直接用于后续的特征提取、时频分析或功能连接分析。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302131362.png" alt="" /></p><h4 id="542-时域特征熵特征"><a class="markdownIt-Anchor" href="#542-时域特征熵特征"></a> 5.4.2 时域特征：熵特征</h4><p>该模块用于从 EEG 信号中提取多种熵类特征，以量化信号的复杂性与不确定性。</p><p>用户可根据研究需求选择不同的熵类型（如 Shannon 熵、谱熵、排列熵等），并设置相应参数后执行特征计算。</p><p>在确认参数配置后，点击 <strong><code>提取特征</code></strong> 按钮即可完成熵特征提取，结果将以通道为单位进行汇总，并可导出用于后续统计分析或机器学习建模。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302139918.png" alt="" /></p><h4 id="543-时频特征timefrequency-ersp时频谱"><a class="markdownIt-Anchor" href="#543-时频特征timefrequency-ersp时频谱"></a> 5.4.3 时频特征（Time–Frequency / ERSP）：时频谱</h4><p>该模块用于对 EEG 信号进行时频分析，以刻画不同频段功率随时间的动态变化，常用于事件相关去同步/同步（ERD/ERS）分析。</p><h5 id="1计算方法"><a class="markdownIt-Anchor" href="#1计算方法"></a> 1）计算方法</h5><ul><li>可选择 <strong>Morlet 小波变换</strong> 或  <strong>Multitaper</strong> 对 epochs 数据进行时频分解</li><li>支持自定义：<ul><li>频率范围（<code>fmin</code> – <code>fmax</code>）</li><li>频率分辨率（<code>n_freqs</code>）</li><li>小波周期数（<code>n_cycles</code>）</li><li>时间带宽参数</li></ul></li></ul><h5 id="2基线校正"><a class="markdownIt-Anchor" href="#2基线校正"></a> 2）基线校正</h5><ul><li>支持自动或自定义基线区间</li><li>可输出相对基线的功率变化（如百分比形式）</li></ul><h5 id="3可视化与输出"><a class="markdownIt-Anchor" href="#3可视化与输出"></a> 3）可视化与输出</h5><ul><li>支持按单通道或通道平均方式显示结果</li><li>可选择特定频段（如 α、β 波段）进行 ERD/ERS 分析（选择后需点击 <strong><code>更新图像</code></strong> 按钮）</li><li>结果可导出用于后续统计分析或机器学习建模<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302146721.png" alt="" /></li></ul><h4 id="544-功能连接"><a class="markdownIt-Anchor" href="#544-功能连接"></a> 5.4.4 功能连接</h4><p>该模块用于计算 EEG 通道间的功能连接关系，以刻画脑区之间的同步性与信息交互模式。<br /><strong>可选择预定义频段（δ、θ、α、β 等）或自定义频率范围</strong></p><h5 id="1-连接指标"><a class="markdownIt-Anchor" href="#1-连接指标"></a> 1) 连接指标</h5><ul><li><p><strong>Coherence（相干性）</strong><br />基于频域的线性相关度量，反映两个通道在特定频段内的幅值与相位一致性。适用于分析稳定的振荡同步，但对体积传导较为敏感。</p></li><li><p><strong>COH（Complex Coherence）</strong><br />复数形式的相干性，保留相位差信息，可用于更精细的频域连接分析。</p></li><li><p><strong>PLV（Phase Locking Value）</strong><br />基于相位一致性的非线性指标，用于衡量信号间相位同步程度，对幅值变化不敏感，常用于事件相关或任务态分析。<br />可参考：<a href="https://blog.csdn.net/qq_45538220/article/details/124435846?spm=1001.2014.3001.5501">https://blog.csdn.net/qq_45538220/article/details/124435846?spm=1001.2014.3001.5501</a></p></li><li><p><strong>PLI（Phase Lag Index）</strong><br />基于相位滞后的连接指标，可在一定程度上抑制零时滞同步带来的体积传导影响，更强调具有方向性的相位关系。</p></li><li><p><strong>wPLI（Weighted Phase Lag Index）</strong><br />PLI 的加权改进版本，通过增强稳定相位滞后成分，提高对噪声的鲁棒性，在功能脑网络研究中被广泛采用。<br />可参考：<a href="https://blog.csdn.net/qq_45538220/article/details/129873029?spm=1001.2014.3001.5501">https://blog.csdn.net/qq_45538220/article/details/129873029?spm=1001.2014.3001.5501</a></p></li></ul><h5 id="2-连接矩阵与可视化"><a class="markdownIt-Anchor" href="#2-连接矩阵与可视化"></a> 2) 连接矩阵与可视化</h5><ul><li>计算结果以通道 × 通道的连接矩阵形式表示</li><li>支持显示连接强度热图</li><li>可提取 <strong>Top-K 强连接边</strong> 以突出主要功能连接模式</li></ul><h5 id="3-网络分析"><a class="markdownIt-Anchor" href="#3-网络分析"></a> 3) 网络分析</h5><ul><li>基于连接矩阵构建功能脑网络</li><li>支持阈值或 Top-K 方式构图</li><li>可进一步计算图论指标（如节点度、聚类系数等），用于脑网络拓扑分析<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302152452.png" alt="" /><br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302153535.png" alt="" /></li></ul><h5 id="4日志log"><a class="markdownIt-Anchor" href="#4日志log"></a> 4）日志（Log）</h5><p>日志模块用于记录用户在软件中的关键操作与数据处理过程，以增强分析流程的可追溯性与结果的可复现性。<br />日志信息包括但不限于：</p><ul><li>数据载入与状态更新（如 raw / epoch / 插值状态）</li><li>事件标记与 epoch 构建结果</li><li>各类特征计算的启动与完成状态</li><li>特征类别、所用方法及关键参数配置</li><li>数据维度信息（如 epoch 数、通道数、时间点数）</li><li>功能连接与网络分析的统计摘要</li></ul><p>日志内容按时间顺序实时更新，可作为后续结果核查、参数复现及科研记录的重要参考。<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302157503.png" alt="" /></p><hr /><h2 id="6-fnirs模块使用说明"><a class="markdownIt-Anchor" href="#6-fnirs模块使用说明"></a> 6. fNIRS模块使用说明</h2><p>本模块用于完成 fNIRS 数据的载入、预处理、事件切分及特征提取，支持基于血红蛋白浓度变化的任务相关分析。</p><h3 id="61-载入数据load-data"><a class="markdownIt-Anchor" href="#61-载入数据load-data"></a> 6.1 载入数据（Load Data）</h3><p>在 <strong>Load Data</strong> 页面中，选择并加载 fNIRS 数据文件。<br />系统将自动读取通道信息、采样率及记录时长，并初始化数据状态。</p><p>加载完成后，可预览原始信号及探头空间布局（3D），用于初步检查数据质量与通道分布。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302209363.png" alt="" /></p><hr /><h3 id="62-预处理preprocessing"><a class="markdownIt-Anchor" href="#62-预处理preprocessing"></a> 6.2 预处理（Preprocessing）</h3><h4 id="621-转换-质量控制与血红蛋白计算"><a class="markdownIt-Anchor" href="#621-转换-质量控制与血红蛋白计算"></a> 6.2.1 转换、质量控制与血红蛋白计算</h4><p>在 <strong>Convert + QC + Hb</strong> 页面中，系统依次执行：</p><ul><li>光强 --&gt; 光密度（Optical Density）转换</li><li>基于源–探测器距离与 SCI（Scalp Coupling Index）的质量控制</li><li>基于 Beer–Lambert 定律计算血红蛋白浓度变化（HbO / HbR）</li></ul><p>处理过程中可查看 SCI 分布直方图与血红蛋白信号，以辅助评估通道质量。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302159476.png" alt="" /></p><h4 id="622-filter-epoch"><a class="markdownIt-Anchor" href="#622-filter-epoch"></a> 6.2.2 Filter + Epoch</h4><p>该模块用于对 fNIRS 血红蛋白信号进行带通滤波，以抑制低频漂移与高频生理噪声，保留与任务相关的血氧动力学变化。</p><ul><li><strong>低频截止（Low frequency）</strong>：用于去除缓慢基线漂移（如仪器漂移）</li><li><strong>高频截止（High frequency）</strong>：用于抑制心率、呼吸等高频生理噪声</li></ul><p>滤波完成后，可通过 <strong><code>View Epoch/Events</code></strong> 按钮查看事件标记在时间轴上的分布，用于确认事件与信号时序的一致性。</p><p>在确认参数设置后，点击 <strong><code>Run</code></strong> 按钮即可执行滤波操作，结果将用于后续的事件切分与特征提取流程。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302159603.png" alt="" /></p><hr /><h3 id="63-特征提取feature-extraction"><a class="markdownIt-Anchor" href="#63-特征提取feature-extraction"></a> 6.3 特征提取（Feature Extraction）</h3><h4 id="631-epoch-可视化epoch-visualization"><a class="markdownIt-Anchor" href="#631-epoch-可视化epoch-visualization"></a> 6.3.1 Epoch 可视化（Epoch Visualization）</h4><p>在 <strong>Epoch Visualization</strong> 页面中，可构建 epochs ，并对epochs进行检查与展示：</p><ul><li>支持选择血红蛋白类型（HbO或HbR）</li><li>提供Evoke时程曲线、 epoch 热图（epoch Image）与联合视图（Joint plot）</li><li>显示基线位置与任务相关响应变化<br />该步骤有助于快速评估任务诱发的血氧动力学响应特征。<br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302200871.png" alt="" /></li></ul><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302200987.png" alt="" /></p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302201062.png" alt="" /></p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302201960.png" alt="" /></p><h4 id="632-特征提取feature-extraction"><a class="markdownIt-Anchor" href="#632-特征提取feature-extraction"></a> 6.3.2 特征提取：Feature Extraction</h4><p>在 <strong>Feature Extraction</strong> 页面中，可从 epochs 中提取常用 fNIRS 特征：</p><ul><li>提取特征包括：<ul><li>均值（mean）</li><li>标准差（std）</li><li>峰值（peak）</li><li>曲线下面积（AUC）</li><li>上升斜率（slope）</li><li>峰值时间（TTP）</li></ul></li></ul><p>特征结果以表格形式展示，并可导出为 CSV 文件，用于后续统计分析或机器学习建模。</p><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202512302201101.png" alt="" /></p><hr /><h3 id="64-数据保存save"><a class="markdownIt-Anchor" href="#64-数据保存save"></a> 6.4 数据保存（Save）</h3><p>预处理及特征提取完成后，可将结果数据保存到本地。保存操作不会修改原始数据文件，确保数据安全与可追溯性。</p><hr /><h2 id="7-semg模块使用说明"><a class="markdownIt-Anchor" href="#7-semg模块使用说明"></a> 7. sEMG模块使用说明</h2><h3 id="待更新"><a class="markdownIt-Anchor" href="#待更新"></a> 待更新……</h3><hr /><h2 id="8-常见问题faq"><a class="markdownIt-Anchor" href="#8-常见问题faq"></a> 8. 常见问题（FAQ）</h2><h3 id="q1双击软件没有反应-一闪而过"><a class="markdownIt-Anchor" href="#q1双击软件没有反应-一闪而过"></a> Q1：双击软件没有反应 / 一闪而过</h3><p><strong>解决方法：</strong></p><ol><li>确认操作系统为 64 位 Windows</li><li>安装 Microsoft Visual C++ Redistributable 2015–2022（x64）</li><li>确保未删除 <code>_internal</code> 文件夹</li></ol><h3 id="q2软件提示某某库未安装"><a class="markdownIt-Anchor" href="#q2软件提示某某库未安装"></a> Q2：软件提示“某某库未安装”</h3><p>这是软件内部依赖问题，并非用户操作错误。</p><p><strong>解决方法：</strong></p><ul><li>请联系软件开发者获取更新版本</li><li>不需要、也无法在 exe 中执行 <code>pip install</code></li></ul><h3 id="q3处理大文件时运行较慢"><a class="markdownIt-Anchor" href="#q3处理大文件时运行较慢"></a> Q3：处理大文件时运行较慢</h3><ul><li>属于正常现象</li><li>建议：<ul><li>使用性能更高的计算机</li><li>避免同时运行大量程序</li></ul></li></ul><hr /><h2 id="9-注意事项与已知限制"><a class="markdownIt-Anchor" href="#9-注意事项与已知限制"></a> 9. 注意事项与已知限制</h2><ul><li>当前版本主要面向单文件交互式处理</li><li>暂不支持批量自动化处理</li><li>暂不支持 Linux / macOS 系统</li></ul><hr /><h2 id="10-版本信息与联系方式"><a class="markdownIt-Anchor" href="#10-版本信息与联系方式"></a> 10. 版本信息与联系方式</h2><ul><li><strong>软件名称</strong>：NeuroSignal Preprocessor</li><li><strong>当前版本</strong>：v1.0.0</li><li><strong>发布日期</strong>：2025-12-31</li></ul><p>如有问题或建议，请联系开发者。邮箱：wsh_cathy@163.com</p><hr /><p>© 2025 NeuroSignal Preprocessor</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;neurosignal-preprocessor-使用说明&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#neurosignal-preprocessor-使用说明&quot;&gt;&lt;/a&gt; NeuroSignal Preprocessor 使用说明</summary>
      
    
    
    
    <category term="Signal processing" scheme="https://weisihong9.github.io/categories/Signal-processing/"/>
    
    
    <category term="EEG_fNIRS_EMG" scheme="https://weisihong9.github.io/tags/EEG-fNIRS-EMG/"/>
    
  </entry>
  
  <entry>
    <title>MNE_EEG</title>
    <link href="https://weisihong9.github.io/2024/05/15/MNE_EEG/"/>
    <id>https://weisihong9.github.io/2024/05/15/MNE_EEG/</id>
    <published>2024-05-14T16:00:00.000Z</published>
    <updated>2024-05-16T01:30:04.417Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目的介绍用python的mne预处理eeg数据并绘制ersp"><a class="markdownIt-Anchor" href="#目的介绍用python的mne预处理eeg数据并绘制ersp"></a> 目的：介绍用python的MNE预处理EEG数据，并绘制ERSP</h1><p><strong><a href="https://mne.tools/stable/auto_tutorials/intro/10_overview.html#sphx-glr-auto-tutorials-intro-10-overview-py">EEG analysis with MNE-Python</a></strong><br />This tutorial covers the basic EEG pipeline for event-related analysis: loading data, preprocessing, epoching, averaging, plotting, time-frequency analysis, and estimating cortical activity from sensor data.</p><h1 id="一-实验范式"><a class="markdownIt-Anchor" href="#一-实验范式"></a> 一、实验范式</h1><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405142229370.png" alt="" /></p><h1 id="二-预处理"><a class="markdownIt-Anchor" href="#二-预处理"></a> 二、预处理</h1><h2 id="1-加载package"><a class="markdownIt-Anchor" href="#1-加载package"></a> 1. 加载package</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> mne</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.<span class="property">pyplot</span> <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> mne.<span class="property">preprocessing</span> <span class="keyword">import</span> <span class="title class_">EOGRegression</span></span><br><span class="line"><span class="keyword">from</span> scipy.<span class="property">ndimage</span> <span class="keyword">import</span> gaussian_filter1d</span><br><span class="line"><span class="keyword">from</span> mne.<span class="property">time_frequency</span> <span class="keyword">import</span> tfr_morlet</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.<span class="title function_">filterwarnings</span>(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">warnings.<span class="title function_">simplefilter</span>(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"></span><br><span class="line">%matplotlib qt</span><br></pre></td></tr></table></figure><h2 id="2-加载数据"><a class="markdownIt-Anchor" href="#2-加载数据"></a> 2. 加载数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">path = <span class="string">&#x27;.\\EEG\\set\\&#x27;</span></span><br><span class="line">fileName = <span class="string">&quot;clench_right&quot;</span></span><br><span class="line">raw = mne.<span class="property">io</span>.<span class="title function_">read_raw_eeglab</span>(path + fileName + <span class="string">&#x27;.set&#x27;</span>) </span><br><span class="line">raw.<span class="property">info</span></span><br></pre></td></tr></table></figure><h2 id="3-设置眼电-心电-去除不要的channel"><a class="markdownIt-Anchor" href="#3-设置眼电-心电-去除不要的channel"></a> 3. 设置眼电、心电、去除不要的channel</h2><p>这里根据你自己的电极来设定</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pd.<span class="title class_">DataFrame</span>(raw.<span class="property">ch_names</span>)                               # 查看通道名称</span><br><span class="line">raw.<span class="title function_">set_channel_types</span>(&#123;<span class="string">&#x27;HEOG&#x27;</span>:<span class="string">&#x27;eog&#x27;</span>, <span class="string">&#x27;VEOG&#x27;</span>:<span class="string">&#x27;eog&#x27;</span>&#125;)      # <span class="number">32</span>导联，<span class="variable constant_">VEO</span>垂直眼电，<span class="variable constant_">HEO</span>水平眼电，<span class="variable constant_">ECG</span>心电 # </span><br><span class="line">raw.<span class="title function_">pick</span>(picks=<span class="string">&#x27;all&#x27;</span>, exclude=[<span class="string">&#x27;TRIGGER&#x27;</span>, <span class="string">&#x27;ECG&#x27;</span>, <span class="string">&#x27;EMG&#x27;</span>]) # 去除无用电极</span><br></pre></td></tr></table></figure><h2 id="4-查看raw数据波形关注信噪比该数据是否可用坏导插值"><a class="markdownIt-Anchor" href="#4-查看raw数据波形关注信噪比该数据是否可用坏导插值"></a> 4. 查看raw数据波形，关注信噪比，该数据是否可用【坏导插值】</h2><h3 id="40-查看raw波形绘制psd"><a class="markdownIt-Anchor" href="#40-查看raw波形绘制psd"></a> 4.0 查看raw波形，绘制psd</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">raw.<span class="title function_">plot</span>(start=<span class="number">10</span>, duration=<span class="number">1</span>)  # 从10s开始，窗口显示时长1s</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br><span class="line">raw.<span class="title function_">plot_psd</span>(fmin=<span class="number">0</span>, fmax=<span class="number">250</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405142236142.png" alt="" /></p><h3 id="41-挑选坏导"><a class="markdownIt-Anchor" href="#41-挑选坏导"></a> 4.1 挑选坏导</h3><p>把认为是坏导的，鼠标左键点击一下变灰即可</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.<span class="title function_">plot</span>(start=<span class="number">10</span>, duration=<span class="number">1</span>, title=<span class="string">&#x27;请选择需要插值的坏导&#x27;</span>)  # 从20s开始，窗口显示时长1s</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><h3 id="42-插值坏导"><a class="markdownIt-Anchor" href="#42-插值坏导"></a> 4.2 插值坏导</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">raw.<span class="title function_">load_data</span>()  # 默认情况下，<span class="variable constant_">MNE</span>不会将数据加载到主内存以节约资源。插值需要加载原始数据。在构造函数或raw.<span class="title function_">load_data</span>()中使用preload=<span class="title class_">True</span>（或字符串）。</span><br><span class="line">raw.<span class="title function_">interpolate_bads</span>()</span><br></pre></td></tr></table></figure><h2 id="5-带通滤波2-~-40"><a class="markdownIt-Anchor" href="#5-带通滤波2-~-40"></a> 5. 带通滤波：2 ~ 40   *</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">raw_filter = raw.<span class="title function_">copy</span>()</span><br><span class="line">raw_filter.<span class="title function_">load_data</span>()</span><br><span class="line">raw_filter.<span class="title function_">filter</span>(l_freq=<span class="number">2</span>, h_freq=<span class="number">40</span>, n_jobs=<span class="number">1</span>) </span><br></pre></td></tr></table></figure><h2 id="6-重参考"><a class="markdownIt-Anchor" href="#6-重参考"></a> 6. 重参考   *</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw_ref = raw_filter.<span class="title function_">copy</span>()</span><br></pre></td></tr></table></figure><h3 id="61-双侧乳突参考"><a class="markdownIt-Anchor" href="#61-双侧乳突参考"></a> 6.1 双侧乳突参考</h3><p>因为我在采集数据时，用的参考电极是M2，这里再次选择双侧乳突参考的原理参考<a href="https://blog.csdn.net/qq_45538220/article/details/134305680?spm=1001.2014.3001.5502">这篇文章</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 添加 M2，值为0 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"># add <span class="keyword">new</span> reference channel (all zero) 添加一个新的参考电极，值为<span class="number">0</span>，这样选择<span class="variable constant_">M1</span>，<span class="variable constant_">M2</span>重参考，就相当于 <span class="number">1</span>/<span class="number">2</span> <span class="variable constant_">M1</span>啦</span><br><span class="line">raw_new_ref = mne.<span class="title function_">add_reference_channels</span>(raw_ref, ref_channels=[<span class="string">&quot;M2&quot;</span>])</span><br><span class="line"># raw_new_ref.<span class="title function_">plot</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 双侧乳突重参考&#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">raw_new_ref.<span class="title function_">set_eeg_reference</span>(ref_channels=[<span class="string">&#x27;M1&#x27;</span>, <span class="string">&#x27;M2&#x27;</span>])</span><br></pre></td></tr></table></figure><h3 id="62-平均参考"><a class="markdownIt-Anchor" href="#62-平均参考"></a> 6.2 平均参考</h3><p><strong>平均参考的话，一般放到ICA之后</strong></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">raw_ref.<span class="title function_">set_eeg_reference</span>(ref_channels=<span class="string">&#x27;average&#x27;</span>) </span><br></pre></td></tr></table></figure><h2 id="7-ica去眼电"><a class="markdownIt-Anchor" href="#7-ica去眼电"></a> 7. ICA去眼电              *</h2><h3 id="71-选取需要去除的ica成分"><a class="markdownIt-Anchor" href="#71-选取需要去除的ica成分"></a> 7.1 选取需要去除的ICA成分</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. ICA，独立成分分析去除眼电和心电伪迹&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">ica = mne.<span class="property">preprocessing</span>.<span class="title function_">ICA</span>(n_components=<span class="number">20</span>, max_iter=<span class="number">800</span>)  # 定义一个<span class="variable constant_">ICA</span>方法</span><br><span class="line">ica.<span class="title function_">fit</span>(raw_new_ref)                                         # 训练<span class="variable constant_">ICA</span>模型</span><br><span class="line">raw_new_ref.<span class="title function_">load_data</span>()</span><br><span class="line">ica.<span class="title function_">plot_sources</span>(raw_new_ref, show_scrollbars=<span class="title class_">True</span>, title=<span class="string">&#x27;请选择需要去除的成分&#x27;</span>)  </span><br><span class="line">ica.<span class="title function_">plot_components</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 对ICA之后的成分进行绘制，跟前面选择坏导方法一致 &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405142246206.png" alt="" /></p><h3 id="72-ica成分剔除"><a class="markdownIt-Anchor" href="#72-ica成分剔除"></a> 7.2 ICA成分剔除</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 3. 查看选择去除的成分个数 &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line"><span class="title function_">print</span>(ica)</span><br><span class="line">raw_ICA = raw_new_ref.<span class="title function_">copy</span>()</span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 4. 去除刚刚选择的伪迹成分 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">raw_ICA = ica.<span class="title function_">apply</span>(raw_ICA)  </span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 5. ICA去除前后波形比较&#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">raw_new_ref.<span class="title function_">plot</span>(start=<span class="number">1</span>, duration=<span class="number">5</span>, title=<span class="string">&#x27;ICA处理前，如无误请关闭窗口&#x27;</span>)</span><br><span class="line">raw_ICA.<span class="title function_">plot</span>(start=<span class="number">1</span>, duration=<span class="number">5</span>, title=<span class="string">&#x27;ICA处理后，如无误请关闭窗口&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405142246769.png" alt="" /></p><h2 id="8-通道定位"><a class="markdownIt-Anchor" href="#8-通道定位"></a> 8. 通道定位    *</h2><p>这一步一般不需要，只不过是因为我的电极重新布置了，所以得重新定位<br />自定义电极位置，需要自定义电极布局文件对数据进行通道定位可以查看<a href="https://blog.csdn.net/qq_45538220/article/details/131552815?spm=1001.2014.3001.5502">这篇文章</a>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># 查看通道名称</span><br><span class="line">raw_ICA_rename = raw_ICA.<span class="title function_">copy</span>()</span><br><span class="line">raw_ICA_rename.<span class="title function_">pick</span>(picks=<span class="string">&#x27;all&#x27;</span>, exclude=[<span class="string">&#x27;M1&#x27;</span>, <span class="string">&#x27;M2&#x27;</span>,<span class="string">&#x27;HEOG&#x27;</span>,<span class="string">&#x27;VEOG&#x27;</span>])</span><br><span class="line"># pd.<span class="title class_">DataFrame</span>(raw_ICA_rename.<span class="property">ch_names</span>)</span><br><span class="line">raw_chName = raw_ICA_rename.<span class="property">ch_names</span></span><br><span class="line"></span><br><span class="line">rename_chName = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> ch <span class="keyword">in</span> <span class="attr">raw_chName</span>:</span><br><span class="line">    <span class="keyword">if</span> ch == <span class="string">&#x27;T7&#x27;</span>:</span><br><span class="line">        rename_chName[ch] = <span class="string">&#x27;C5&#x27;</span></span><br><span class="line">    elif ch == <span class="string">&#x27;TP7&#x27;</span>:</span><br><span class="line">        rename_chName[ch] = <span class="string">&#x27;CP5&#x27;</span></span><br><span class="line">    elif ch == <span class="string">&#x27;T8&#x27;</span>:</span><br><span class="line">        rename_chName[ch] = <span class="string">&#x27;C6&#x27;</span></span><br><span class="line">    elif ch == <span class="string">&#x27;TP8&#x27;</span>:</span><br><span class="line">        rename_chName[ch] = <span class="string">&#x27;CP6&#x27;</span></span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        rename_chName[ch] = ch</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 通道重命名 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">raw_ICA_rename.<span class="title function_">rename_channels</span>(rename_chName)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 加载定位文件&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">myStardart1020 = pd.<span class="title function_">read_excel</span>(<span class="string">&#x27;sensor_dataFrame_32.xlsx&#x27;</span>, index_col=<span class="number">0</span>) </span><br><span class="line"> </span><br><span class="line">ch_names = np.<span class="title function_">array</span>(myStardart1020.<span class="property">index</span>)       # 电极名称</span><br><span class="line">position = np.<span class="title function_">array</span>(myStardart1020)             # 电极坐标位置</span><br><span class="line">sensorPosition = <span class="title function_">dict</span>(<span class="title function_">zip</span>(ch_names, position))  # 制定为字典的形式</span><br><span class="line">montage = mne.<span class="property">channels</span>.<span class="title function_">make_dig_montage</span>(ch_pos=sensorPosition)</span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 3. 通道定位 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">raw_ICA_rename.<span class="title function_">set_montage</span>(montage)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405142249074.png" alt="" /></p><h2 id="9-保存预处理后的数据"><a class="markdownIt-Anchor" href="#9-保存预处理后的数据"></a> 9. 保存预处理后的数据</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub = <span class="string">&#x27;sub1_&#x27;</span></span><br><span class="line">raw_ICA_rename.<span class="title function_">save</span>(<span class="string">&quot;.//1_preProcessData//&quot;</span>+ sub +fileName+<span class="string">&quot;_M1reRef_preP-eeg.fif&quot;</span>, overwrite = <span class="title class_">False</span>)</span><br></pre></td></tr></table></figure><h1 id="三-提取epochevoked"><a class="markdownIt-Anchor" href="#三-提取epochevoked"></a> 三、提取epoch，evoked           *</h1><h2 id="1-绘制events图"><a class="markdownIt-Anchor" href="#1-绘制events图"></a> 1. 绘制events图</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events, event_dict = mne.<span class="title function_">events_from_annotations</span>(raw_ICA_rename)</span><br><span class="line">event_id = &#123;<span class="string">&#x27;Fix&#x27;</span>:event_dict[<span class="string">&#x27;1&#x27;</span>], <span class="string">&#x27;task&#x27;</span>:event_dict[<span class="string">&#x27;3&#x27;</span>],<span class="string">&#x27;Rest&#x27;</span>:event_dict[<span class="string">&#x27;5&#x27;</span>]&#125;  # marker类型由自己的范式任务决定</span><br><span class="line">plt.<span class="property">rcParams</span>[<span class="string">&#x27;figure.figsize&#x27;</span>]=(<span class="number">7</span>, <span class="number">5</span>)</span><br><span class="line">mne.<span class="property">viz</span>.<span class="title function_">plot_events</span>(events, event_id=event_id, sfreq=raw.<span class="property">info</span>[<span class="string">&quot;sfreq&quot;</span>])</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150857144.png" alt="" /></p><h2 id="2-根据marker提取epoch"><a class="markdownIt-Anchor" href="#2-根据marker提取epoch"></a> 2. 根据marker提取epoch</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">events = mne.<span class="title function_">events_from_annotations</span>(raw_ICA_rename)</span><br><span class="line">event_dic = &#123;<span class="string">&#x27;Fix&#x27;</span>:events[<span class="number">1</span>][<span class="string">&#x27;1&#x27;</span>], </span><br><span class="line">             <span class="string">&#x27;task&#x27;</span>:events[<span class="number">1</span>][<span class="string">&#x27;3&#x27;</span>],</span><br><span class="line">             <span class="string">&#x27;Rest&#x27;</span>:events[<span class="number">1</span>][<span class="string">&#x27;5&#x27;</span>]&#125; </span><br><span class="line"># reject_criteria = <span class="title function_">dict</span>(eeg=<span class="number">100e-6</span>)  # 幅度大于<span class="number">100</span>微幅的不要，这个可要可不要，即振幅过大就去除</span><br><span class="line">epochs = mne.<span class="title class_">Epochs</span>(raw_ICA_rename, </span><br><span class="line">                    events[<span class="number">0</span>], </span><br><span class="line">                    event_id=event_dic, </span><br><span class="line">                    preload=<span class="title class_">True</span>,</span><br><span class="line">                    tmax=<span class="number">20</span>, tmin=-<span class="number">10</span>,          # 刺激前10s，刺激后20s</span><br><span class="line">                    # reject=reject_criteria,</span><br><span class="line">                    baseline = <span class="title class_">None</span>,            # 要做<span class="variable constant_">ERSP</span>，提取epoch时不需要基线矫正  baseline= (-<span class="number">2</span>,<span class="number">0</span>)</span><br><span class="line">                   ) </span><br><span class="line">epochs</span><br></pre></td></tr></table></figure><h2 id="3-目视并手动去除伪迹依然严重的epoch"><a class="markdownIt-Anchor" href="#3-目视并手动去除伪迹依然严重的epoch"></a> 3. 目视并手动去除伪迹依然严重的epoch</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task_epochs = epochs[<span class="string">&#x27;task&#x27;</span>]</span><br><span class="line">task_epochs.<span class="title function_">plot</span>(title=<span class="string">&quot;请目视挑出坏epochs&quot;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><h2 id="4-绘制evoked时域波形"><a class="markdownIt-Anchor" href="#4-绘制evoked时域波形"></a> 4. 绘制evoked时域波形</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">task_evoked = task_epochs.<span class="title function_">average</span>()</span><br><span class="line">task_evoked.<span class="title function_">plot</span>(picks=[<span class="string">&#x27;C3&#x27;</span>,<span class="string">&#x27;C4&#x27;</span>], xlim=(-<span class="number">2</span>,<span class="number">2</span>))</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150904440.png" alt="" /></p><h2 id="5-绘制evoked的psd"><a class="markdownIt-Anchor" href="#5-绘制evoked的psd"></a> 5. 绘制evoked的psd</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">task_evoked.<span class="title function_">crop</span>(<span class="number">0</span>,<span class="number">12</span>).<span class="title function_">plot_psd</span>(fmin=<span class="number">2</span>, fmax=<span class="number">30</span>,</span><br><span class="line">                     picks=[<span class="string">&#x27;C3&#x27;</span>, <span class="string">&#x27;C4&#x27;</span>],</span><br><span class="line">                     # method = <span class="string">&#x27;welch&#x27;</span>,</span><br><span class="line">                     xscale=<span class="string">&#x27;linear&#x27;</span>,</span><br><span class="line">                     dB=<span class="title class_">False</span>,</span><br><span class="line">                     estimate=<span class="string">&#x27;amplitude&#x27;</span>,</span><br><span class="line"></span><br><span class="line">                    )</span><br><span class="line">plt.<span class="title function_">title</span>(sub + fileName)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150906398.png" alt="" /></p><h2 id="6-绘制evoked某一时刻的脑地形图"><a class="markdownIt-Anchor" href="#6-绘制evoked某一时刻的脑地形图"></a> 6. 绘制evoked某一时刻的脑地形图</h2><p>只能选择某一时刻<br />参考：<a href="https://mne.tools/dev/auto_examples/visualization/evoked_topomap.html#sphx-glr-auto-examples-visualization-evoked-topomap-py">https://mne.tools/dev/auto_examples/visualization/evoked_topomap.html#sphx-glr-auto-examples-visualization-evoked-topomap-py</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">times = np.<span class="title function_">arange</span>(-<span class="number">2</span>, <span class="number">14</span>, <span class="number">2</span>)</span><br><span class="line">task_evoked.<span class="title function_">plot_topomap</span>(times, ch_type=<span class="string">&quot;eeg&quot;</span>, ncols=<span class="number">4</span>, nrows=<span class="string">&quot;auto&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150907014.png" alt="" /></p><h1 id="四-绘制ersp"><a class="markdownIt-Anchor" href="#四-绘制ersp"></a> 四. 绘制ERSP           *</h1><p><strong>要计算ERSP，提取epoch时不需要基线矫正。</strong><br />ERSP：反映了信号中不同频率的功率相对于特定时间点（例如信号出现）的变化程度。<br />事件相关同步化/去同步化：event-related synchronization / desynchronization （ERS/ERD）</p><ul><li>ERD 对应于特定频带内的功率相对于基线的降低。类似地，ERS 对应于功率的增加。</li><li>ERDS 图是 ERD/ERS 在一定频率范围内的时间/频率表示形式。</li><li>ERDS 地图也称为 ERSP（事件相关频谱扰动：event-related spectral perturbation， ERSP）。<br />参考：<a href="https://zh-1-peng.gitbook.io/eeg-analysis-note/ersp">https://zh-1-peng.gitbook.io/eeg-analysis-note/ersp</a><br /><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150910391.png" alt="" /></li></ul><h2 id="1-定义小波函数计算时频谱"><a class="markdownIt-Anchor" href="#1-定义小波函数计算时频谱"></a> 1. 定义小波函数计算时频谱</h2><p>参考：<a href="https://mne.tools/stable/auto_tutorials/time-freq/20_sensors_time_frequency.html#sphx-glr-auto-tutorials-time-freq-20-sensors-time-frequency-py">https://mne.tools/stable/auto_tutorials/time-freq/20_sensors_time_frequency.html#sphx-glr-auto-tutorials-time-freq-20-sensors-time-frequency-py</a></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mne.<span class="property">time_frequency</span> <span class="keyword">import</span> tfr_morlet</span><br><span class="line">freqs = np.<span class="title function_">logspace</span>(*np.<span class="title function_">log10</span>([<span class="number">2</span>, <span class="number">40</span>]), num=<span class="number">80</span>)</span><br><span class="line">n_cycles = freqs / <span class="number">2.0</span>  # different number <span class="keyword">of</span> cycle per frequency</span><br><span class="line"># <span class="number">1.</span> 定义函数</span><br><span class="line">def <span class="title function_">getPSD</span>(dataEpochs):</span><br><span class="line">    power1, itc = <span class="title function_">tfr_morlet</span>(</span><br><span class="line">            dataEpochs,</span><br><span class="line">            freqs=freqs,</span><br><span class="line">            n_cycles=n_cycles,</span><br><span class="line">            use_fft=<span class="title class_">True</span>,</span><br><span class="line">            return_itc=<span class="title class_">True</span>,</span><br><span class="line">            decim=<span class="number">3</span>,</span><br><span class="line">            n_jobs=<span class="number">1</span>,)</span><br><span class="line">    <span class="keyword">return</span> power1, itc</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> 计算</span><br><span class="line">task_power, itc = <span class="title function_">getPSD</span>(task_epochs)</span><br></pre></td></tr></table></figure><h2 id="2-绘制单通道ersp"><a class="markdownIt-Anchor" href="#2-绘制单通道ersp"></a> 2. 绘制单通道ERSP</h2><p><strong>mode：‘mean’ | ‘ratio’ | ‘logratio’ | ‘percent’ | ‘zscore’ | ‘zlogratio’</strong><br />Perform baseline correction by</p><ul><li><p>subtracting the mean of baseline values (‘mean’)</p></li><li><p>dividing by the mean of baseline values (‘ratio’)</p></li><li><p>dividing by the mean of baseline values and taking the log (‘logratio’)</p></li><li><p>subtracting the mean of baseline values followed by dividing by the mean of baseline values (‘percent’)</p></li><li><p>subtracting the mean of baseline values and dividing by the standard deviation of baseline values (‘zscore’)</p></li><li><p>dividing by the mean of baseline values, taking the log, and dividing by the standard deviation of log baseline values (‘zlogratio’)</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">plotTF</span>(taskPower, tmin1, tmax1, ch, fn):</span><br><span class="line">    # ch：需要绘制的导联名称</span><br><span class="line">    # 绘制时频图</span><br><span class="line">    taskPower.<span class="title function_">plot</span>(</span><br><span class="line">        picks = task_power.<span class="property">ch_names</span>.<span class="title function_">index</span>(ch),</span><br><span class="line">        baseline=(-<span class="number">7</span>, -<span class="number">3</span>),                     # 这里我选择基线是（-<span class="number">7</span>~-<span class="number">3</span>），后面的power都减去基线的均值。表示：所有特定频带内的功率相对于基线（-<span class="number">7</span>，-<span class="number">3</span>）的变化程度</span><br><span class="line">        mode=<span class="string">&quot;percent&quot;</span>,   # 具体含义参考上面的解释</span><br><span class="line">        tmin=tmin1, tmax=tmax1, </span><br><span class="line">        vmin=-<span class="number">1</span>, vmax=<span class="number">1</span>,</span><br><span class="line">        show=<span class="title class_">False</span>,</span><br><span class="line">        colorbar=<span class="title class_">True</span>,</span><br><span class="line">        # cmap=<span class="string">&#x27;jet&#x27;</span>,</span><br><span class="line">    )</span><br><span class="line">    plt.<span class="title function_">ylim</span>([<span class="number">0</span>, <span class="number">40</span>])</span><br><span class="line">    plt.<span class="title function_">suptitle</span>(ch)</span><br><span class="line">    plt.<span class="title function_">savefig</span>(<span class="string">&quot;.//1_preProcessData//TFA//&quot;</span>+fn+ch, dpi=<span class="number">600</span>)   # 保存绘制的<span class="variable constant_">TF</span></span><br><span class="line"></span><br><span class="line"># 绘制</span><br><span class="line">fn = sub+ fileName</span><br><span class="line"><span class="title function_">plotTF</span>(task_power, -<span class="number">10</span>, <span class="number">20</span>, <span class="string">&#x27;C3&#x27;</span>, fn)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150916876.png" alt="" /><br />可以发现在任务时期，0~8s内，alpha频段的能量相较于基线明显下降，这是明显的<strong>ERD现象</strong>。</p><h2 id="3-绘制所有通道的ersp"><a class="markdownIt-Anchor" href="#3-绘制所有通道的ersp"></a> 3. 绘制所有通道的ERSP</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">task_power.<span class="title function_">plot_topo</span>(baseline=(-<span class="number">7</span>, -<span class="number">3</span>), mode=<span class="string">&#x27;percent&#x27;</span>, vmin=-<span class="number">1</span>, vmax=<span class="number">1</span>, title=<span class="string">&quot;Average power&quot;</span>)  # mode=<span class="string">&quot;logratio&quot;</span></span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150919301.png" alt="" /></p><h2 id="4-保存计算的时频谱"><a class="markdownIt-Anchor" href="#4-保存计算的时频谱"></a> 4. 保存计算的时频谱</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;task_power.pkl&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> <span class="attr">f</span>:</span><br><span class="line">    pickle.<span class="title function_">dump</span>(task_power, f)</span><br></pre></td></tr></table></figure><h2 id="5-加载保存好的时频谱"><a class="markdownIt-Anchor" href="#5-加载保存好的时频谱"></a> 5. 加载保存好的时频谱</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="title function_">open</span>(<span class="string">&#x27;task_power.pkl&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> <span class="attr">f</span>:</span><br><span class="line">    task_power = pickle.<span class="title function_">load</span>(f)</span><br></pre></td></tr></table></figure><h2 id="6-时间进程上特定频段power的变化"><a class="markdownIt-Anchor" href="#6-时间进程上特定频段power的变化"></a> 6. 时间进程上特定频段power的变化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">getPowerDataFrameTime</span>(power_task, ch_pair):</span><br><span class="line">    freqs = np.<span class="title function_">arange</span>(<span class="number">2</span>, <span class="number">40</span>)  # frequencies <span class="keyword">from</span> <span class="number">2</span>-35Hz</span><br><span class="line">    # vmin, vmax = -<span class="number">1</span>, <span class="number">1.5</span>  # set min and max <span class="variable constant_">ERDS</span> values <span class="keyword">in</span> plot</span><br><span class="line">    baseline = (-<span class="number">7</span>, -<span class="number">3</span>)  # baseline interval (<span class="keyword">in</span> s)</span><br><span class="line">    tmin, tmax = -<span class="number">7</span>, <span class="number">20</span></span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; ERSD： percent： 减去基线值的平均值，再除以基线值的平均值（&quot;百分比） &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">    power_task.<span class="title function_">crop</span>(tmin, tmax).<span class="title function_">apply_baseline</span>(baseline, mode=<span class="string">&quot;percent&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 0. 字典形式 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    df = power_task.<span class="title function_">to_data_frame</span>(time_format=<span class="title class_">None</span>, long_format=<span class="title class_">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 选择感兴趣的通道 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    new_categories = ch_pair</span><br><span class="line">    df = df[df.<span class="property">channel</span>.<span class="title function_">isin</span>(new_categories)]</span><br><span class="line">    df[<span class="string">&quot;channel&quot;</span>] = df[<span class="string">&quot;channel&quot;</span>].<span class="property">cat</span>.<span class="title function_">remove_unused_categories</span>()</span><br><span class="line">    df[<span class="string">&quot;channel&quot;</span>] = df[<span class="string">&quot;channel&quot;</span>].<span class="property">cat</span>.<span class="title function_">reorder_categories</span>(new_categories, ordered=<span class="title class_">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 选择感兴趣的频段 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    freq_bounds = &#123;<span class="string">&quot;_&quot;</span>: <span class="number">0</span>, <span class="string">&quot;delta&quot;</span>: <span class="number">4</span>, <span class="string">&quot;theta&quot;</span>: <span class="number">8</span>, <span class="string">&quot;alpha&quot;</span>: <span class="number">13</span>, <span class="string">&quot;beta&quot;</span>: <span class="number">30</span>, <span class="string">&quot;gamma&quot;</span>:<span class="number">40</span>&#125;</span><br><span class="line">    df[<span class="string">&quot;band&quot;</span>] = pd.<span class="title function_">cut</span>(</span><br><span class="line">        df[<span class="string">&quot;freq&quot;</span>], <span class="title function_">list</span>(freq_bounds.<span class="title function_">values</span>()), labels=<span class="title function_">list</span>(freq_bounds)[<span class="number">1</span>:]</span><br><span class="line">    )</span><br><span class="line">    freq_bands_of_interest = [<span class="string">&quot;alpha&quot;</span>,<span class="string">&quot;beta&quot;</span>]  # <span class="string">&quot;delta&quot;</span>, <span class="string">&quot;theta&quot;</span>,, <span class="string">&quot;beta&quot;</span>, <span class="string">&quot;gamma&quot;</span></span><br><span class="line">    df = df[df.<span class="property">band</span>.<span class="title function_">isin</span>(freq_bands_of_interest)]</span><br><span class="line">    df[<span class="string">&quot;band&quot;</span>] = df[<span class="string">&quot;band&quot;</span>].<span class="property">cat</span>.<span class="title function_">remove_unused_categories</span>()</span><br><span class="line">    <span class="keyword">return</span> df</span><br><span class="line"></span><br><span class="line"># <span class="number">1.</span> 选择感兴趣的通道</span><br><span class="line">ch_pairs = [<span class="string">&#x27;C3&#x27;</span>, <span class="string">&#x27;CZ&#x27;</span>, <span class="string">&#x27;C4&#x27;</span>]</span><br><span class="line"></span><br><span class="line"># <span class="number">2.</span> 获取统计的<span class="title class_">DataFrame</span></span><br><span class="line">task_power_time = <span class="title function_">getPowerDataFrameTime</span>(task_power.<span class="title function_">copy</span>(), ch_pairs)</span><br><span class="line"></span><br><span class="line"># <span class="number">3.</span> 绘图</span><br><span class="line">g = sns.<span class="title class_">FacetGrid</span>(task_power_time, row=<span class="string">&quot;band&quot;</span>, margin_titles=<span class="title class_">True</span>)</span><br><span class="line">g.<span class="title function_">map</span>(sns.<span class="property">lineplot</span>, <span class="string">&quot;time&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;channel&quot;</span>, n_boot=<span class="number">10</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">axline_kw = <span class="title function_">dict</span>(color=<span class="string">&quot;black&quot;</span>, linestyle=<span class="string">&quot;dashed&quot;</span>, linewidth=<span class="number">0.5</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axhline</span>, y=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axvline</span>, x=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">refline</span>(x=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">g.<span class="title function_">refline</span>(y=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">g.<span class="title function_">set</span>(ylim=(-<span class="number">0.9</span>, <span class="number">0.9</span>))</span><br><span class="line">g.<span class="title function_">set_axis_labels</span>(<span class="string">&quot;Time (s)&quot;</span>, <span class="string">&quot;ERDS&quot;</span>)</span><br><span class="line">g.<span class="title function_">set_titles</span>(col_template=<span class="string">&quot;&#123;col_name&#125;&quot;</span>, row_template=<span class="string">&quot;&#123;row_name&#125;&quot;</span>)</span><br><span class="line">g.<span class="title function_">add_legend</span>(ncol=<span class="number">3</span>, loc=<span class="string">&quot;lower center&quot;</span>)</span><br><span class="line">g.<span class="property">fig</span>.<span class="title function_">subplots_adjust</span>(left=<span class="number">0.1</span>, right=<span class="number">0.9</span>, top=<span class="number">0.9</span>, bottom=<span class="number">0.08</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150923609.png" alt="" /><br />另一种画法</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">g = sns.<span class="title class_">FacetGrid</span>(task_power_time, row=<span class="string">&quot;band&quot;</span>, col=<span class="string">&quot;channel&quot;</span>, margin_titles=<span class="title class_">True</span>)</span><br><span class="line">g.<span class="title function_">map</span>(sns.<span class="property">lineplot</span>, <span class="string">&quot;time&quot;</span>, <span class="string">&quot;value&quot;</span>,  n_boot=<span class="number">10</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">axline_kw = <span class="title function_">dict</span>(color=<span class="string">&quot;black&quot;</span>, linestyle=<span class="string">&quot;dashed&quot;</span>, linewidth=<span class="number">0.5</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axhline</span>, y=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axvline</span>, x=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">refline</span>(x=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">g.<span class="title function_">refline</span>(y=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">g.<span class="title function_">set</span>(ylim=(-<span class="number">0.9</span>, <span class="number">0.9</span>))</span><br><span class="line">g.<span class="title function_">set_axis_labels</span>(<span class="string">&quot;Time (s)&quot;</span>, <span class="string">&quot;ERDS&quot;</span>)</span><br><span class="line">g.<span class="title function_">set_titles</span>(col_template=<span class="string">&quot;&#123;col_name&#125;&quot;</span>, row_template=<span class="string">&quot;&#123;row_name&#125;&quot;</span>)</span><br><span class="line">g.<span class="title function_">add_legend</span>(ncol=<span class="number">2</span>, loc=<span class="string">&quot;lower center&quot;</span>)</span><br><span class="line">g.<span class="property">fig</span>.<span class="title function_">subplots_adjust</span>(left=<span class="number">0.1</span>, right=<span class="number">0.9</span>, top=<span class="number">0.9</span>, bottom=<span class="number">0.08</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150924645.png" alt="" /></p><h2 id="7-频段进程上特定时间段power的变化"><a class="markdownIt-Anchor" href="#7-频段进程上特定时间段power的变化"></a> 7. 频段进程上特定时间段power的变化</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">getPowerDataFrameBand</span>(power_task, ch_pair):</span><br><span class="line">    freqs = np.<span class="title function_">arange</span>(<span class="number">2</span>, <span class="number">40</span>)  # frequencies <span class="keyword">from</span> <span class="number">2</span>-35Hz</span><br><span class="line">    # vmin, vmax = -<span class="number">1</span>, <span class="number">1.5</span>  # set min and max <span class="variable constant_">ERDS</span> values <span class="keyword">in</span> plot</span><br><span class="line">    baseline = (-<span class="number">7</span>, -<span class="number">3</span>)  # baseline interval (<span class="keyword">in</span> s)</span><br><span class="line">    tmin, tmax = -<span class="number">7</span>, <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 基线  &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">    power_task.<span class="title function_">crop</span>(tmin, tmax).<span class="title function_">apply_baseline</span>(baseline, mode=<span class="string">&quot;percent&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 0. 字典形式 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    df = power_task.<span class="title function_">to_data_frame</span>(time_format=<span class="title class_">None</span>, long_format=<span class="title class_">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 选择感兴趣的通道 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    new_categories = ch_pair</span><br><span class="line">    df = df[df.<span class="property">channel</span>.<span class="title function_">isin</span>(new_categories)]</span><br><span class="line">    df[<span class="string">&quot;channel&quot;</span>] = df[<span class="string">&quot;channel&quot;</span>].<span class="property">cat</span>.<span class="title function_">remove_unused_categories</span>()</span><br><span class="line">    df[<span class="string">&quot;channel&quot;</span>] = df[<span class="string">&quot;channel&quot;</span>].<span class="property">cat</span>.<span class="title function_">reorder_categories</span>(new_categories, ordered=<span class="title class_">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 选择感兴趣的时间段 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    df_mean = (df.<span class="title function_">query</span>(<span class="string">&quot;time &gt; 1 &amp; time &lt; 7&quot;</span>)</span><br><span class="line">                .<span class="title function_">groupby</span>([<span class="string">&quot;channel&quot;</span>,<span class="string">&quot;freq&quot;</span>], observed=<span class="title class_">False</span>)[[<span class="string">&quot;value&quot;</span>]]</span><br><span class="line">                .<span class="title function_">mean</span>()</span><br><span class="line">                .<span class="title function_">reset_index</span>()</span><br><span class="line">                )</span><br><span class="line">    <span class="keyword">return</span> df_mean</span><br><span class="line"></span><br><span class="line"># 计算</span><br><span class="line">ch_pairs = [<span class="string">&#x27;C3&#x27;</span>, <span class="string">&#x27;C4&#x27;</span>]</span><br><span class="line">task_power_band = <span class="title function_">getPowerDataFrameBand</span>(task_power.<span class="title function_">copy</span>(), ch_pairs)</span><br><span class="line">task_power_band</span><br><span class="line"></span><br><span class="line"># 绘制</span><br><span class="line">g = sns.<span class="title class_">FacetGrid</span>(task_power_band, margin_titles=<span class="title class_">True</span>)</span><br><span class="line">g.<span class="title function_">map</span>(sns.<span class="property">lineplot</span>, <span class="string">&quot;freq&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;channel&quot;</span>,n_boot=<span class="number">10</span>, linewidth=<span class="number">2</span>)</span><br><span class="line">axline_kw = <span class="title function_">dict</span>(color=<span class="string">&quot;black&quot;</span>, linestyle=<span class="string">&quot;dashed&quot;</span>, linewidth=<span class="number">0.5</span>, alpha=<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axhline</span>, y=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">map</span>(plt.<span class="property">axvline</span>, x=<span class="number">0</span>, **axline_kw)</span><br><span class="line">g.<span class="title function_">refline</span>(x=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">g.<span class="title function_">refline</span>(y=<span class="number">0</span>, color=<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"># g.<span class="title function_">set</span>(ylim=(<span class="title class_">None</span>, <span class="number">0.5</span>))</span><br><span class="line">g.<span class="title function_">set_axis_labels</span>(<span class="string">&quot;Frequency (Hz)&quot;</span>, <span class="string">&quot;ERDS&quot;</span>)</span><br><span class="line">g.<span class="title function_">set_titles</span>(col_template=<span class="string">&quot;&#123;col_name&#125;&quot;</span>, row_template=<span class="string">&quot;&#123;row_name&#125;&quot;</span>)</span><br><span class="line"></span><br><span class="line">g.<span class="title function_">add_legend</span>(ncol=<span class="number">3</span>, loc=<span class="string">&quot;upper center&quot;</span>)</span><br><span class="line">g.<span class="property">fig</span>.<span class="title function_">subplots_adjust</span>(left=<span class="number">0.1</span>, right=<span class="number">0.9</span>, top=<span class="number">0.9</span>, bottom=<span class="number">0.08</span>)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150929157.png" alt="" /></p><h2 id="8-绘制ersd-map"><a class="markdownIt-Anchor" href="#8-绘制ersd-map"></a> 8. 绘制ERSD Map</h2><p>可以选择频段和时间区间</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">plotTopoMap</span>(taskPower, tmin1, tmax1, fn):</span><br><span class="line">    # topomap_args = <span class="title function_">dict</span>(extrapolate=<span class="string">&quot;local&quot;</span>)</span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 选择感兴趣的频段 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    plot_dict = <span class="title function_">dict</span>(<span class="title class_">Alpha</span>=<span class="title function_">dict</span>(fmin=<span class="number">9</span>, fmax=<span class="number">12</span>))  </span><br><span class="line">    <span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 选择感兴趣的时间区间：tmin1, tmax1 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">    topomap_kw = <span class="title function_">dict</span>(tmin=tmin1, tmax=tmax1, baseline=(-<span class="number">7</span>, -<span class="number">3</span>),  mode=<span class="string">&quot;percent&quot;</span>,  show=<span class="title class_">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (title, fmin_fmax) <span class="keyword">in</span> plot_dict.<span class="title function_">items</span>():</span><br><span class="line">        taskPower.<span class="title function_">plot_topomap</span>(**fmin_fmax, </span><br><span class="line">                               # cmap=<span class="string">&#x27;Pastel1&#x27;</span>,</span><br><span class="line">                               # vlim=(-<span class="number">0.7</span>, <span class="number">0.7</span>),                                        </span><br><span class="line">                               **topomap_kw,</span><br><span class="line">                               # **topomap_args</span><br><span class="line">                              )</span><br><span class="line">          </span><br><span class="line">    </span><br><span class="line">    plt.<span class="title function_">suptitle</span>(<span class="title function_">str</span>(tmin1) +<span class="string">&#x27;_&#x27;</span>+ <span class="title function_">str</span>(tmax1)+<span class="string">&#x27;s_8-11Hz&#x27;</span>)</span><br><span class="line">    plt.<span class="title function_">savefig</span>(<span class="string">&quot;.//1_preProcessData//TopoMap//&quot;</span>+fn, dpi=<span class="number">600</span>)</span><br><span class="line">    </span><br><span class="line">fn1 = sub + fileName</span><br><span class="line"><span class="title function_">plotTopoMap</span>(taskPower=task_power, tmin1=<span class="number">0</span>, tmax1=<span class="number">7</span>, fn=fn1)</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/weisihong9/wshBlogPic/main/202405150930916.png" alt="" /></p><p>以上就是从EEG预处理到绘制ERSP的全部过程，这里考虑了很多情况，步骤有点多，如果想要修改但不知道怎么改的可以给我留言哦。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;目的介绍用python的mne预处理eeg数据并绘制ersp&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的介绍用python的mne预处理eeg数据并绘制ersp&quot;&gt;&lt;/a&gt; 目的：介绍用python的MNE预处理EEG数据，并绘</summary>
      
    
    
    
    <category term="EEG" scheme="https://weisihong9.github.io/categories/EEG/"/>
    
    <category term="ERSP" scheme="https://weisihong9.github.io/categories/EEG/ERSP/"/>
    
    
    <category term="ERSP" scheme="https://weisihong9.github.io/tags/ERSP/"/>
    
  </entry>
  
  <entry>
    <title>BrainNetwork</title>
    <link href="https://weisihong9.github.io/2023/11/24/BrainNetwork/"/>
    <id>https://weisihong9.github.io/2023/11/24/BrainNetwork/</id>
    <published>2023-11-23T16:00:00.000Z</published>
    <updated>2023-11-24T02:48:05.727Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的利用matlab工具包-brainnet-viewer-绘制脑网络图"><a class="markdownIt-Anchor" href="#目的利用matlab工具包-brainnet-viewer-绘制脑网络图"></a> 目的：利用matlab工具包 BrainNet Viewer 绘制脑网络图</h2><h3 id="1-brainnet-viewer-的主要功能"><a class="markdownIt-Anchor" href="#1-brainnet-viewer-的主要功能"></a> 1. BrainNet Viewer 的主要功能</h3><ul><li>脑网络的多视角显示</li><li>显示多种<strong>脑曲面、节点和边</strong>构成的不同组合</li><li>多种方式调<strong>节点、边的颜色和大小</strong></li><li><strong>自定阈值</strong>来提取相关矩阵中的边信息</li><li>实现体素图像到曲面的映射</li><li>可进行放大、缩小、旋转等交互式操作</li><li>支持jpg、png等多种格式的输出</li></ul><h3 id="2-brainnet-viewer-的安装"><a class="markdownIt-Anchor" href="#2-brainnet-viewer-的安装"></a> 2. BrainNet Viewer 的安装</h3><p>去<a href="https://www.nitrc.org/frs/download.php/11580/BrainNetViewer_20191031.zip">官网下载BrianNet Viewer</a>工具包放到自己电脑的文件夹里。<br />因为BrianNet Viewer是基于Matlab的，故只需要在Matlab的路径里面添加BrianNet Viewer的文件路径即可。<br /><a href="https://imgse.com/i/piw9aZt"><img src="https://z1.ax1x.com/2023/11/23/piw9aZt.png" alt="piw9aZt.png" /></a></p><h3 id="3-brainnet-viewer-的使用"><a class="markdownIt-Anchor" href="#3-brainnet-viewer-的使用"></a> 3. BrainNet Viewer 的使用</h3><h4 id="1打开matlab在命令行窗口输入brainnet"><a class="markdownIt-Anchor" href="#1打开matlab在命令行窗口输入brainnet"></a> 1）打开Matlab，在命令行窗口输入：<code>BrainNet</code></h4><p><a href="https://imgse.com/i/piw9szQ"><img src="https://z1.ax1x.com/2023/11/23/piw9szQ.png" alt="piw9szQ.png" /></a></p><h4 id="2进入brainnet-viewer界面"><a class="markdownIt-Anchor" href="#2进入brainnet-viewer界面"></a> 2）进入BrainNet Viewer界面</h4><p><a href="https://imgse.com/i/piw9css"><img src="https://z1.ax1x.com/2023/11/23/piw9css.png" alt="piw9css.png" /></a></p><h4 id="3bn类型"><a class="markdownIt-Anchor" href="#3bn类型"></a> 3）BN类型</h4><p>BrainNet Viewer可以产生多种组合图（如下图），因为我做的是EEG，所以常用的是第5种，后面我们会详细介绍此种图的画法，也简单介绍第9种。<br /><a href="https://imgse.com/i/piw9Wd0"><img src="https://z1.ax1x.com/2023/11/23/piw9Wd0.png" alt="piw9Wd0.png" /></a></p><h3 id="4-脑网络绘制流程"><a class="markdownIt-Anchor" href="#4-脑网络绘制流程"></a> 4. 脑网络绘制流程</h3><ul><li>读入文件</li><li>设置绘图格式</li><li>脑网络图显示</li><li>结果导出</li><li>调整node label</li></ul><hr /><blockquote><h4 id="1读入文件"><a class="markdownIt-Anchor" href="#1读入文件"></a> 1）读入文件</h4></blockquote><ul><li><p>1 脑曲面文件（Surface file）：ASCII文件，后缀名为‘nv’，包含了脑曲面上的顶点和三角曲面信息</p></li><li><p>2 <strong>节点文件（node file）</strong>：ASCII文件，后缀名为’node’，为<strong>nx6</strong>的矩阵，包含了节点的坐标、颜色、大小和标签信息</p></li><li><p>3 <strong>边文件（edge file）</strong>：ASCII文件，后缀名为‘edge’，为<strong>nxn</strong>矩阵，即节点间的相关矩阵</p></li><li><p>4 三维图像文件（volume file）：NIFTI或Analyze格式，后缀名为配对的‘hdr’和‘img’该文件仅用于体素到曲面的映射绘制</p></li><li><p>[x] File —&gt; Load File<br /><a href="https://imgse.com/i/piwCdX9"><img src="https://z1.ax1x.com/2023/11/23/piwCdX9.png" alt="piwCdX9.png" /></a></p></li></ul><p><strong>文件说明</strong></p><h5 id="asurface-file"><a class="markdownIt-Anchor" href="#asurface-file"></a> a）Surface file</h5><p><a href="https://imgse.com/i/piwPSA0"><img src="https://z1.ax1x.com/2023/11/23/piwPSA0.png" alt="piwPSA0.png" /></a></p><h5 id="anode-file"><a class="markdownIt-Anchor" href="#anode-file"></a> a）Node file</h5><p><a href="https://imgse.com/i/piwPpNV"><img src="https://z1.ax1x.com/2023/11/23/piwPpNV.png" alt="piwPpNV.png" /></a></p><h5 id="aedge-file"><a class="markdownIt-Anchor" href="#aedge-file"></a> a）Edge file</h5><p><a href="https://imgse.com/i/piwFhnJ"><img src="https://z1.ax1x.com/2023/11/23/piwFhnJ.png" alt="piwFhnJ.png" /></a><br /><a href="https://imgse.com/i/piwCx7q"><img src="https://z1.ax1x.com/2023/11/23/piwCx7q.png" alt="piwCx7q.png" /></a></p><hr /><blockquote><h4 id="2设置绘图格式"><a class="markdownIt-Anchor" href="#2设置绘图格式"></a> 2）设置绘图格式</h4></blockquote><ul><li>1 带label的图：前面导入文件添加完路径点击‘ok’按钮之后会出现右图的界面，选择 <strong>Node --&gt; Label All --&gt; Colomap</strong><br />点击‘ok’即可画出脑网络连接图。</li><li>2 选择<strong>Colomap</strong>画出来的节点颜色会根据你node文件节点颜色部分来分配。</li><li>3 如果选择<strong>Modular</strong>，可以根据node文件节点颜色序号来自定义节点颜色。</li><li>4 不带label的图：只需把<strong>Label ALL</strong> 变成 <strong>Label None</strong>即可<br /><a href="https://imgse.com/i/piwF57R"><img src="https://z1.ax1x.com/2023/11/23/piwF57R.png" alt="piwF57R.png" /></a><br /><a href="https://imgse.com/i/piwFTtx"><img src="https://z1.ax1x.com/2023/11/23/piwFTtx.png" alt="piwFTtx.png" /></a><br /><a href="https://imgse.com/i/piwFoA1"><img src="https://z1.ax1x.com/2023/11/23/piwFoA1.png" alt="piwFoA1.png" /></a></li></ul><hr /><blockquote><h4 id="3脑网络图显示"><a class="markdownIt-Anchor" href="#3脑网络图显示"></a> 3）脑网络图显示</h4></blockquote><p><a href="https://imgse.com/i/piwkXGV"><img src="https://z1.ax1x.com/2023/11/23/piwkXGV.png" alt="piwkXGV.png" /></a></p><hr /><blockquote><h4 id="4结果导出"><a class="markdownIt-Anchor" href="#4结果导出"></a> 4）结果导出</h4></blockquote><p><a href="https://imgse.com/i/piwkOP0"><img src="https://z1.ax1x.com/2023/11/23/piwkOP0.png" alt="piwkOP0.png" /></a></p><hr /><blockquote><h4 id="5调整node-label"><a class="markdownIt-Anchor" href="#5调整node-label"></a> 5）调整node label</h4></blockquote><p><a href="https://imgse.com/i/piwkj2T"><img src="https://z1.ax1x.com/2023/11/23/piwkj2T.png" alt="piwkj2T.png" /></a></p><p><a href="https://imgse.com/i/piwElm4"><img src="https://z1.ax1x.com/2023/11/23/piwElm4.png" alt="piwElm4.png" /></a></p><hr /><h3 id="5-roi-的绘制"><a class="markdownIt-Anchor" href="#5-roi-的绘制"></a> 5. ROI 的绘制</h3><p><a href="https://imgse.com/i/piwApqJ"><img src="https://z1.ax1x.com/2023/11/23/piwApqJ.png" alt="piwApqJ.png" /></a></p><p><a href="https://imgse.com/i/piwEK6U"><img src="https://z1.ax1x.com/2023/11/23/piwEK6U.png" alt="piwEK6U.png" /></a></p><p>参考：<a href="https://blog.csdn.net/dxfgcvhjbnklm/article/details/120731430?spm=1001.2101.3001.6650.6&amp;utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-6-120731430-blog-109013671.235%5Ev38%5Epc_relevant_anti_vip&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromBaidu%7ERate-6-120731430-blog-109013671.235%5Ev38%5Epc_relevant_anti_vip&amp;utm_relevant_index=13">AAL模板及脑区功能介绍</a></p><h3 id="关于brainnet-viewer的更多具体使用可以参考brainnet_manualpdf"><a class="markdownIt-Anchor" href="#关于brainnet-viewer的更多具体使用可以参考brainnet_manualpdf"></a> 关于BrainNet Viewer的更多具体使用可以参考BrainNet_Manual.pdf</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;目的利用matlab工具包-brainnet-viewer-绘制脑网络图&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的利用matlab工具包-brainnet-viewer-绘制脑网络图&quot;&gt;&lt;/a&gt; 目的：利用matlab工具包 </summary>
      
    
    
    
    <category term="EEG" scheme="https://weisihong9.github.io/categories/EEG/"/>
    
    <category term="FBN" scheme="https://weisihong9.github.io/categories/EEG/FBN/"/>
    
    
    <category term="FBN" scheme="https://weisihong9.github.io/tags/FBN/"/>
    
  </entry>
  
  <entry>
    <title>DiGraph</title>
    <link href="https://weisihong9.github.io/2023/10/25/DiGraph/"/>
    <id>https://weisihong9.github.io/2023/10/25/DiGraph/</id>
    <published>2023-10-24T16:00:00.000Z</published>
    <updated>2023-10-25T12:59:19.571Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的绘制加权有向连接图"><a class="markdownIt-Anchor" href="#目的绘制加权有向连接图"></a> 目的：绘制加权有向连接图</h2><h3 id="1-用连接边的颜色表示两个节点之间的强度"><a class="markdownIt-Anchor" href="#1-用连接边的颜色表示两个节点之间的强度"></a> 1. 用连接边的颜色表示两个节点之间的强度</h3><p><a href="https://imgse.com/i/piVrNtK"><img src="https://z1.ax1x.com/2023/10/25/piVrNtK.png" alt="piVrNtK.png" /></a></p><h3 id="2-用边的权重来表示节点连接的强度"><a class="markdownIt-Anchor" href="#2-用边的权重来表示节点连接的强度"></a> 2. 用边的权重来表示节点连接的强度</h3><p><a href="https://imgse.com/i/piVrtk6"><img src="https://z1.ax1x.com/2023/10/25/piVrtk6.png" alt="piVrtk6.png" /></a></p><h3 id="参考"><a class="markdownIt-Anchor" href="#参考"></a> 参考：</h3><p><a href="https://networkx.org/documentation/stable/auto_examples/drawing/plot_directed.html">https://networkx.org/documentation/stable/auto_examples/drawing/plot_directed.html</a><br /><a href="https://networkx.org/documentation/stable/reference/generated/networkx.drawing.nx_pylab.draw_networkx.html">https://networkx.org/documentation/stable/reference/generated/networkx.drawing.nx_pylab.draw_networkx.html</a></p><h3 id="0-加载python库"><a class="markdownIt-Anchor" href="#0-加载python库"></a> 0. 加载python库</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.<span class="property">pyplot</span> <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"><span class="keyword">import</span> matplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure><h3 id="1-用连接边的颜色表示两个节点之间的强度-2"><a class="markdownIt-Anchor" href="#1-用连接边的颜色表示两个节点之间的强度-2"></a> 1. 用连接边的颜色表示两个节点之间的强度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;0. 自己的权重值矩阵&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">value_new=[[<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.005</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.007</span>,<span class="number">0.</span>,<span class="number">0.008</span>],</span><br><span class="line">       [<span class="number">0.011</span>,<span class="number">0.013</span>,<span class="number">0.</span>,<span class="number">0.012</span>,<span class="number">0.</span>,<span class="number">0.01</span>,<span class="number">0.009</span>,<span class="number">0.016</span>]]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 初始化图&#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">G = nx.<span class="title class_">MultiDiGraph</span>()</span><br><span class="line">pos = nx.<span class="title function_">spring_layout</span>(G)</span><br><span class="line"></span><br><span class="line"># 设置节点名称</span><br><span class="line">row = np.<span class="title function_">array</span>([<span class="string">&#x27;FL&#x27;</span>,<span class="string">&#x27;FM&#x27;</span>,<span class="string">&#x27;FR&#x27;</span>,<span class="string">&#x27;TL&#x27;</span>,<span class="string">&#x27;TR&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line">G.<span class="title function_">add_nodes_from</span>([<span class="string">&#x27;FL&#x27;</span>,<span class="string">&#x27;FM&#x27;</span>,<span class="string">&#x27;FR&#x27;</span>,<span class="string">&#x27;TL&#x27;</span>,<span class="string">&#x27;TR&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 将节点的连接边权重加入构建的图&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> value_new[i][j] != <span class="number">0</span>:</span><br><span class="line">            G.<span class="title function_">add_weighted_edges_from</span>([(row[j],row[i],value_new[i][j])])#边的起点，终点，权重    </span><br><span class="line">        <span class="attr">else</span>:</span><br><span class="line">            pass</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 3. 节点的设置 &#x27;</span><span class="string">&#x27;&#x27;</span>        </span><br><span class="line"># 节点大小        </span><br><span class="line">node_sizes = [<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>]</span><br><span class="line"># 节点颜色</span><br><span class="line">node_color = [<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>]</span><br><span class="line"># 设置节点位置</span><br><span class="line">pos=&#123;<span class="string">&#x27;FL&#x27;</span>:(<span class="number">38</span>,<span class="number">75</span>),<span class="string">&#x27;FM&#x27;</span>:(<span class="number">40</span>,<span class="number">80</span>),<span class="string">&#x27;FR&#x27;</span>:(<span class="number">42</span>,<span class="number">75</span>),</span><br><span class="line">     <span class="string">&#x27;TL&#x27;</span>:(<span class="number">37</span>,<span class="number">64</span>),<span class="string">&#x27;C&#x27;</span>:(<span class="number">40</span>,<span class="number">65</span>), <span class="string">&#x27;TR&#x27;</span>:(<span class="number">43</span>,<span class="number">64</span>),</span><br><span class="line">     <span class="string">&#x27;P&#x27;</span>:(<span class="number">38</span>,<span class="number">53</span>),<span class="string">&#x27;O&#x27;</span>:(<span class="number">42</span>,<span class="number">53</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 4. 边的颜色:  用连接边的颜色表示两个节点之间的强度/ 可以用边的权重来表示节点连接的强度 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">edge_colors=[<span class="title function_">float</span>(v[<span class="string">&#x27;weight&#x27;</span>]) <span class="keyword">for</span> (r,c,v) <span class="keyword">in</span> G.<span class="title function_">edges</span>(data=<span class="title class_">True</span>)]  </span><br><span class="line">cmap = plt.<span class="property">cm</span>.<span class="property">jet</span>  # jet、viridis、plasma、inferno、magma、cividis...</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 5. 绘图 &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line"># 绘制节点</span><br><span class="line">nx.<span class="title function_">draw_networkx_nodes</span>(G,pos,</span><br><span class="line">                       node_size=node_sizes,</span><br><span class="line">                       #node_color=node_color,</span><br><span class="line">                       alpha=<span class="number">0.4</span></span><br><span class="line">                      )</span><br><span class="line"># 节点字体大小</span><br><span class="line">nx.<span class="title function_">draw_networkx_labels</span>(G,pos,font_size=<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"># 绘制连接边</span><br><span class="line">edges = nx.<span class="title function_">draw_networkx_edges</span>(G,pos,</span><br><span class="line">        edge_color = edge_colors, </span><br><span class="line">        #alpha=<span class="number">0.5</span>,  # 透明度</span><br><span class="line">        edge_cmap = cmap,</span><br><span class="line">        connectionstyle=<span class="string">&#x27;arc3, rad = 0.25&#x27;</span>,  # arc控制双向，rad调线条弧度</span><br><span class="line">        width=<span class="number">5</span>,</span><br><span class="line">       )</span><br><span class="line"></span><br><span class="line">pc = mpl.<span class="property">collections</span>.<span class="title class_">PatchCollection</span>(edges, cmap=cmap)</span><br><span class="line"># 显示colorbar</span><br><span class="line">pc.<span class="title function_">set_array</span>(edge_colors)</span><br><span class="line"></span><br><span class="line">ax = plt.<span class="title function_">gca</span>()</span><br><span class="line">ax.<span class="title function_">set_axis_off</span>()</span><br><span class="line">plt.<span class="title function_">colorbar</span>(pc, ax=ax)</span><br><span class="line"># 保存图片</span><br><span class="line">plt.<span class="title function_">title</span>(<span class="string">&#x27;Weighted directed connected graph (colour of edges)&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">savefig</span>(<span class="string">&quot;CE_Graph.png&quot;</span>,dpi=<span class="number">600</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/piVrNtK"><img src="https://z1.ax1x.com/2023/10/25/piVrNtK.png" alt="piVrNtK.png" /></a></p><h3 id="2-用边的权重来表示节点连接的强度-2"><a class="markdownIt-Anchor" href="#2-用边的权重来表示节点连接的强度-2"></a> 2. 用边的权重来表示节点连接的强度</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27;0. 自己的权重值矩阵&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">value_new=[[<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.013</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.005</span>,<span class="number">0.</span>],</span><br><span class="line">       [<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.</span>,<span class="number">0.007</span>,<span class="number">0.</span>,<span class="number">0.008</span>],</span><br><span class="line">       [<span class="number">0.011</span>,<span class="number">0.013</span>,<span class="number">0.</span>,<span class="number">0.012</span>,<span class="number">0.</span>,<span class="number">0.01</span>,<span class="number">0.009</span>,<span class="number">0.016</span>]]</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 1. 初始化图&#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line">G = nx.<span class="title class_">MultiDiGraph</span>()</span><br><span class="line">pos = nx.<span class="title function_">spring_layout</span>(G)</span><br><span class="line"></span><br><span class="line">row = np.<span class="title function_">array</span>([<span class="string">&#x27;FL&#x27;</span>,<span class="string">&#x27;FM&#x27;</span>,<span class="string">&#x27;FR&#x27;</span>,<span class="string">&#x27;TL&#x27;</span>,<span class="string">&#x27;TR&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line">G.<span class="title function_">add_nodes_from</span>([<span class="string">&#x27;FL&#x27;</span>,<span class="string">&#x27;FM&#x27;</span>,<span class="string">&#x27;FR&#x27;</span>,<span class="string">&#x27;TL&#x27;</span>,<span class="string">&#x27;TR&#x27;</span>,<span class="string">&#x27;C&#x27;</span>,<span class="string">&#x27;P&#x27;</span>,<span class="string">&#x27;O&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 2. 将节点的连接边权重加入构建的图&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">if</span> value_new[i][j] != <span class="number">0</span>:</span><br><span class="line">            G.<span class="title function_">add_weighted_edges_from</span>([(row[j],row[i],value_new[i][j]*<span class="number">300</span>)]) # 边的起点，终点，权重 ，因为我的权重实在太小了，所以整体扩大<span class="number">300</span>倍   </span><br><span class="line">        <span class="attr">else</span>:</span><br><span class="line">            pass</span><br><span class="line">        </span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 3. 节点的设置 &#x27;</span><span class="string">&#x27;&#x27;</span>        </span><br><span class="line"># 节点大小        </span><br><span class="line">node_sizes = [<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>,<span class="number">1000</span>]</span><br><span class="line"># 节点颜色</span><br><span class="line">node_color = [<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>,<span class="string">&#x27;g&#x27;</span>]</span><br><span class="line"># 设置节点位置</span><br><span class="line">pos=&#123;<span class="string">&#x27;FL&#x27;</span>:(<span class="number">38</span>,<span class="number">75</span>),<span class="string">&#x27;FM&#x27;</span>:(<span class="number">40</span>,<span class="number">80</span>),<span class="string">&#x27;FR&#x27;</span>:(<span class="number">42</span>,<span class="number">75</span>),</span><br><span class="line">     <span class="string">&#x27;TL&#x27;</span>:(<span class="number">37</span>,<span class="number">64</span>),<span class="string">&#x27;C&#x27;</span>:(<span class="number">40</span>,<span class="number">65</span>), <span class="string">&#x27;TR&#x27;</span>:(<span class="number">43</span>,<span class="number">64</span>),</span><br><span class="line">     <span class="string">&#x27;P&#x27;</span>:(<span class="number">38</span>,<span class="number">53</span>),<span class="string">&#x27;O&#x27;</span>:(<span class="number">42</span>,<span class="number">53</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 4. 边的颜色:  用连接边的颜色表示两个节点之间的强度/ 可以用边的权重来表示节点连接的强度 &#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">weight=[<span class="title function_">float</span>(v[<span class="string">&#x27;weight&#x27;</span>]) <span class="keyword">for</span> (r,c,v) <span class="keyword">in</span> G.<span class="title function_">edges</span>(data=<span class="title class_">True</span>)]  </span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;</span><span class="string">&#x27; 5. 绘图 &#x27;</span><span class="string">&#x27;&#x27;</span> </span><br><span class="line"># 绘制节点</span><br><span class="line">nx.<span class="title function_">draw_networkx_nodes</span>(G,pos,</span><br><span class="line">                       node_size=node_sizes,</span><br><span class="line">                       #node_color=node_color,</span><br><span class="line">                       alpha=<span class="number">0.4</span></span><br><span class="line">                      )</span><br><span class="line"># 节点字体大小</span><br><span class="line">nx.<span class="title function_">draw_networkx_labels</span>(G,pos,font_size=<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"># 绘制连接边</span><br><span class="line">edges = nx.<span class="title function_">draw_networkx_edges</span>(G,pos,</span><br><span class="line">        edge_color = <span class="string">&#x27;lightseagreen&#x27;</span>, </span><br><span class="line">        #alpha=<span class="number">0.5</span>,  # 透明度</span><br><span class="line">        edge_cmap = cmap,</span><br><span class="line">        connectionstyle=<span class="string">&#x27;arc3, rad = 0.25&#x27;</span>,  # arc控制双向，rad调线条弧度</span><br><span class="line">        width=weight</span><br><span class="line">       )</span><br><span class="line"># 保存图片</span><br><span class="line">plt.<span class="title function_">savefig</span>(<span class="string">&quot;SE_Graph.png&quot;</span>,dpi=<span class="number">600</span>, bbox_inches=<span class="string">&#x27;tight&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/piVrtk6"><img src="https://z1.ax1x.com/2023/10/25/piVrtk6.png" alt="piVrtk6.png" /></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;目的绘制加权有向连接图&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的绘制加权有向连接图&quot;&gt;&lt;/a&gt; 目的：绘制加权有向连接图&lt;/h2&gt;
&lt;h3 id=&quot;1-用连接边的颜色表示两个节点之间的强度&quot;&gt;&lt;a class=&quot;markdow</summary>
      
    
    
    
    <category term="Graph" scheme="https://weisihong9.github.io/categories/Graph/"/>
    
    <category term="EEG" scheme="https://weisihong9.github.io/categories/Graph/EEG/"/>
    
    
    <category term="BEAM" scheme="https://weisihong9.github.io/tags/BEAM/"/>
    
  </entry>
  
  <entry>
    <title>CrossFrequencyCoupling</title>
    <link href="https://weisihong9.github.io/2023/07/05/CrossFrequencyCoupling/"/>
    <id>https://weisihong9.github.io/2023/07/05/CrossFrequencyCoupling/</id>
    <published>2023-07-05T05:00:49.000Z</published>
    <updated>2023-07-06T08:00:48.066Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目的介绍跨频耦合的背景及常用的计算方法"><a class="markdownIt-Anchor" href="#目的介绍跨频耦合的背景及常用的计算方法"></a> 目的：介绍跨频耦合的背景及常用的计算方法</h1><h2 id="1-背景"><a class="markdownIt-Anchor" href="#1-背景"></a> 1、背景</h2><ol><li>神经科学的核心问题之一是<strong>神经活动如何在不同的空间和时间尺度上协调</strong>。</li><li><strong>跨频率耦合(Cross-frequency coupling, CFC)</strong> 已被提出在时间和空间尺度上协调神经动力学。<ol><li><strong>时间尺度</strong>：神经振荡之间的相幅耦合。例如，低频振荡的相位可以影响高频振荡的振幅，从而调节神经活动的时序，实现信息处理和集成。</li><li><strong>空间尺度</strong>：神经振荡之间的空间耦合。例如，不同频率范围内的神经振荡可以在不同脑区之间相互调节，形成神经网络，实现信息的传递和整合。</li></ol></li><li><strong>EEG信号的CFC</strong>是指不同频率范围内的神经振荡之间存在相互调节和交互作用的现象。换句话说，CFC实际上是不同频带EEG的幅度/频率/相位之间的关系。<strong>常见的耦合关系如下</strong>：【慢震荡（Slow Oscillation，SO）；快震荡（ Fast Oscillation，FO ）】<ol><li><strong>相位-幅度耦合(phase-amplitude coupling，PAC)</strong>：SO的相位与FO幅度之间的耦合，也称为“嵌套”。目前研究比较多的是θ - γ和α - γ之间的PAC。</li><li><strong>相位-频率耦合(phase- frequency coupling，PFC)</strong>：SO的相位和FO的频率之间的耦合。</li><li><strong>相位-相位耦合(phase-phase coupling，PPC)</strong>：SO和FO相位之间的耦合。</li></ol></li></ol><h2 id="2-cfc在神经疾病中的应用"><a class="markdownIt-Anchor" href="#2-cfc在神经疾病中的应用"></a> 2、CFC在神经疾病中的应用</h2><p>跨频耦合作为一种神经机制，在多种神经疾病中都得到了广泛研究：</p><ol><li><strong>癫痫</strong>：研究表明[1]， 跨频频率耦合是定位癫痫组织的有用生物标志物。</li><li><strong>帕金森病</strong>：研究表明[2]，theta-gamma跨频耦合可以作为帕金森疾病的生物标志，并有助于对帕金森疾病的早期诊断和治疗进行监测。</li><li><strong>精神分裂症</strong>：研究表明[3]， theta-gamma跨频耦合减弱与认知障碍症状的严重程度有关。</li><li><strong>抑郁症</strong>：研究表明[4]，抑郁症患者与健康对照组相比，前额叶皮层的theta-gamma跨频耦合存在显著差异。</li></ol><h2 id="3-cfc常用计算方法-5"><a class="markdownIt-Anchor" href="#3-cfc常用计算方法-5"></a> 3、CFC常用计算方法 [5]</h2><ol><li><strong>锁相值（phase-locking value，PLV）</strong></li><li><strong>平均向量长度（mean vector length，MVL）</strong></li><li><strong>调制指数（modulation index，MI）</strong></li></ol><h3 id="31-锁相值phase-locking-valueplv"><a class="markdownIt-Anchor" href="#31-锁相值phase-locking-valueplv"></a> 3.1 锁相值（phase-locking value，PLV）</h3><ol><li><p><strong>定义</strong>：PLV通过比较两个信号的<strong>相位差</strong>来评估它们之间的<strong>同步性</strong>。如果两个信号存在相位-幅度耦合，那么高频时间序列的振幅将在低频振荡。</p></li><li><p><strong>计算步骤</strong><br /><a href="https://imgse.com/i/pCyH5fs"><img src="https://s1.ax1x.com/2023/07/05/pCyH5fs.png" alt="pCyH5fs.png" /></a></p></li><li><p><strong>计算公式</strong></p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mi>L</mi><mi>V</mi><mo>=</mo><mi mathvariant="normal">∣</mi><mfrac><mrow><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msup><mi>e</mi><mrow><mi>i</mi><mo stretchy="false">(</mo><msub><mi>θ</mi><mrow><mi>l</mi><mi>t</mi></mrow></msub><mo>−</mo><msub><mi>θ</mi><mrow><mi>u</mi><mi>t</mi></mrow></msub><mo stretchy="false">)</mo></mrow></msup></mrow><mi>n</mi></mfrac><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">PLV=|\frac{ {\sum_{t=1}^{n}{e^{i(\theta _{lt}-\theta _{ut})} } } }{n}|</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">L</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.26371em;vertical-align:-0.686em;"></span><span class="mord">∣</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.5777100000000002em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8879999999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.3487714285714287em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15122857142857138em;"><span></span></span></span></span></span></span><span class="mbin mtight">−</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord">∣</span></span></span></span></span></p><pre><code>其中n：数据点总数t：时间数据点θlt：t时刻的低频相位角θut：希尔伯特变换后的高频振幅时间序列在t时刻的相位角</code></pre><ol><li><p><strong>优点和缺点</strong>：<br />优点：受噪声影响小。<br />缺点：希尔伯特转换后的振幅时间序列不一定是窄带振荡。</p></li><li><p><strong>python代码实现</strong>：</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 利用<span class="variable constant_">PLV</span>计算相幅耦合</span><br><span class="line">def <span class="title function_">PLV_CFC_WSH</span>(phase, amp):</span><br><span class="line">   # phase：低频信号的相位</span><br><span class="line">   # amp：高频信号的振幅</span><br><span class="line">   amp_phi = np.<span class="title function_">angle</span>(<span class="title function_">hilbert</span>(amp))        # 高频信号振幅的相位</span><br><span class="line">   observed_plv = np.<span class="title function_">abs</span>(np.<span class="title function_">sum</span>(np.<span class="title function_">exp</span>(1j*(phase - amp_phi)))/<span class="title function_">len</span>(phase))</span><br><span class="line">   <span class="keyword">return</span> observed_plv</span><br></pre></td></tr></table></figure><h3 id="32-平均向量长度mean-vector-lengthmvl"><a class="markdownIt-Anchor" href="#32-平均向量长度mean-vector-lengthmvl"></a> 3.2 平均向量长度（mean vector length，MVL）</h3><ol><li><strong>定义</strong>：MVL是一个向量集合中各个向量长度的平均值，它提供了对向量集合整体大小或幅度的一种度量。在CFC的计算中，将对应时刻的<strong>低频信号的相位角作为向量的方向，高频信号的振幅作为向量的幅度</strong>。</li><li><strong>计算步骤</strong>：<br /><a href="https://imgse.com/i/pCyHopn"><img src="https://s1.ax1x.com/2023/07/05/pCyHopn.png" alt="pCyHopn.png" /></a></li><li><strong>计算公式</strong>：</li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mi>V</mi><mi>L</mi><mo>=</mo><mrow><mo fence="true">∣</mo><mfrac><mstyle scriptlevel="0" displaystyle="false"><msubsup><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><mrow><msub><mi>a</mi><mi>t</mi></msub><msup><mi>e</mi><mrow><mi>i</mi><msub><mi>θ</mi><mi>t</mi></msub></mrow></msup></mrow></mstyle><mi>n</mi></mfrac><mo fence="true">∣</mo></mrow></mrow><annotation encoding="application/x-tex">MVL=\left | \frac{ {\textstyle \sum_{t=1}^{n}{a_{t} e^{i\theta _{t}} } } }{n}\right | </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.22222em;">V</span><span class="mord mathnormal">L</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:2.488838em;vertical-align:-0.9500199999999999em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4799700000000002em;"><span style="top:-1.65598em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.25698em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.85798em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.87897em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.47997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500199999999999em;"><span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.538818em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">n</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.6897100000000003em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.804292em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2805559999999999em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.29634285714285713em;"><span style="top:-2.357em;margin-left:-0.02778em;margin-right:0.07142857142857144em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.4799700000000002em;"><span style="top:-1.65598em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.25698em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.85798em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-2.87897em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span><span style="top:-3.47997em;"><span class="pstrut" style="height:2.606em;"></span><span class="delimsizinginner delim-size1"><span>∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9500199999999999em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中:<br />n：数据点总数<br />t：时间数据点<br />at：高频振幅时间序列在t时刻的幅值<br />θt：低频相位时间序列在t时刻的相位角</p><ol><li><strong>优点和缺点</strong>：<br />优点：对于长数据段，高采样率，高信噪比的信号，建议使用MVL。<br />缺点：<ol><li>MVL的计算受到频率振幅的整体幅度影响。如果某个频率的振幅较大，那么它将在计算MVL时有更大的权重。这可能会导致对整个向量集合大小或幅度的评估存在一定的偏差。</li><li>振幅异常值可能会强烈影响平均向量长度。</li><li>不同向量之间的相位角差异可能会影响平均向量长度的计算结果。</li></ol></li><li><strong>python代码实现</strong>：</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 利用<span class="variable constant_">MVL</span>计算相幅耦合</span><br><span class="line">def <span class="title function_">MVL_CFC_WSH</span>(phase, amp):</span><br><span class="line">    # phase：低频信号的相位</span><br><span class="line">    # amp：高频信号的振幅</span><br><span class="line">    amp_nor = (amp - np.<span class="title function_">min</span>(amp)) / (np.<span class="title function_">max</span>(amp) - np.<span class="title function_">min</span>(amp))  # 振幅归一化</span><br><span class="line">    observed_mvl = np.<span class="title function_">abs</span>(np.<span class="title function_">mean</span>(amp_nor * np.<span class="title function_">exp</span>(1j*phase)))</span><br><span class="line">    <span class="keyword">return</span> observed_mvl</span><br></pre></td></tr></table></figure><h3 id="33-调制指数modulation-indexmi"><a class="markdownIt-Anchor" href="#33-调制指数modulation-indexmi"></a> 3.3 调制指数（modulation index，MI）</h3><ol><li><p><strong>定义</strong>：MI通过计算幅度和相位的熵来估计幅度调制指数。</p></li><li><p><strong>计算步骤</strong>：<br /><a href="https://imgse.com/i/pCyH760"><img src="https://s1.ax1x.com/2023/07/05/pCyH760.png" alt="pCyH760.png" /></a></p></li><li><p><strong>计算公式</strong>：</p><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>p</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mover accent="true"><mi>a</mi><mo>ˉ</mo></mover><mrow><mstyle scriptlevel="0" displaystyle="false"><msubsup><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup></mstyle><msub><mover accent="true"><mi>a</mi><mo>ˉ</mo></mover><mi>k</mi></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}p(j)=\frac{\bar{a} }{ {\textstyle \sum_{k=1}^{N}} \bar{a} _{k}} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.7157210000000003em;vertical-align:-1.1078605em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6078605000000004em;"><span style="top:-3.6078605em;"><span class="pstrut" style="height:3.24478em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.24478em;"><span style="top:-2.128769em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.29971000000000003em;"><span></span></span></span></span></span></span></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.56778em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">a</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">ˉ</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.170941em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.1078605em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>ā为单个bin的平均振幅，k为bins的运行指数，N为bins的总数；p是一个有N个值的向量；H(p)为香农熵。</p></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mstyle scriptlevel="0" displaystyle="false"><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><mi>p</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>p</mi><mo stretchy="false">(</mo><mi>j</mi><mo stretchy="false">)</mo></mstyle></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>K</mi><mi>L</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><mi>X</mi><mo stretchy="false">)</mo><mo>=</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo>−</mo><mi>H</mi><mo stretchy="false">(</mo><mi>p</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>M</mi><mi>I</mi><mo>=</mo><mfrac><mrow><mi>K</mi><mi>L</mi><mo stretchy="false">(</mo><mi>U</mi><mo separator="true">,</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><mrow><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} H(p)=- {\textstyle \sum_{j=1}^{N}p(j)logp(j)}\\   KL(U,X)=logN-H(p)\\MI=\frac{KL(U,X)}{logN}  \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:5.824489000000001em;vertical-align:-2.6622445em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.162244500000001em;"><span style="top:-5.6080135em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord">−</span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:-0.0000050000000000050004em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.981231em;"><span style="top:-2.40029em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.43581800000000004em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">)</span></span></span></span><span style="top:-4.0321955em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal">p</span><span class="mclose">)</span></span></span><span style="top:-1.9451955000000003em;"><span class="pstrut" style="height:3.427em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">K</span><span class="mord mathnormal">L</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.6622445em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>U为均匀分布，X为数据分布。<br />KL(U, K): KL散度描述了用均匀分布U来估计数据的真实分布X的编码损失。</p><ol><li><p><strong>优点和缺点</strong>：<br />优点：</p><ol><li>归一化熵是一种常用的信号复杂性度量，可以反映信号的不确定性和信息丰富度。</li><li>对于更短的数据，更低的采样率，更高噪声的数据，建议使用MI。</li><li><strong>MI是使用最多的CFC方法</strong>。</li></ol><p>缺点：<br />4. 依赖于特定的熵测量方法；<br />5. 对数据预处理的要求较高；</p></li><li><p><strong>python代码实现</strong>：</p></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 利用<span class="variable constant_">MI</span>计算相幅耦合</span><br><span class="line">def <span class="title function_">MI_CFC_WSH</span>(phase, amp, nbins):</span><br><span class="line">    # phase：低频信号的相位</span><br><span class="line">    # amp：高频信号的振幅</span><br><span class="line">    # nbins：划分的箱子数</span><br><span class="line">    bins = np.<span class="title function_">linspace</span>(-np.<span class="property">pi</span>, np.<span class="property">pi</span>, nbins+<span class="number">1</span>)   </span><br><span class="line">    # 计算每个相位区间内的振幅均值 </span><br><span class="line">    meanAmp = np.<span class="title function_">zeros</span>(nbins)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(nbins):</span><br><span class="line">        indices = np.<span class="title function_">logical_and</span>(phase &gt;= bins[i], phase &lt; bins[i+<span class="number">1</span>])</span><br><span class="line">        meanAmp[i] = np.<span class="title function_">mean</span>(amp[indices])</span><br><span class="line">    <span class="title class_">Pj</span> = meanAmp/np.<span class="title function_">sum</span>(meanAmp)</span><br><span class="line">    H_Pj = -np.<span class="title function_">sum</span>((<span class="title class_">Pj</span>) * np.<span class="title function_">log</span>(<span class="title class_">Pj</span>))</span><br><span class="line">    <span class="variable constant_">KL</span> = np.<span class="title function_">log</span>(nbins) - H_Pj</span><br><span class="line">    observed_mi = <span class="variable constant_">KL</span> / np.<span class="title function_">log</span>(nbins)</span><br><span class="line">    <span class="keyword">return</span> [observed_mi, meanAmp]</span><br></pre></td></tr></table></figure><h2 id="4-置换检验"><a class="markdownIt-Anchor" href="#4-置换检验"></a> 4、置换检验</h2><ol><li><strong>定义</strong>：置换检验是一种统计方法，通过对数据进行随机重新排序或重组，产生一组随机分布，从而提供了对观察到的效应进行比较的基准。<strong>在计算CFC时，进行置换检验是为了评估观察到的耦合效应是否显著，即是否超出了随机预期。</strong></li><li><strong>计算步骤</strong>：<ol><li>随机在幅值时间序列某数据点上将数据分为两部分，并将<strong>两部分时间序列的顺序颠倒</strong>，构造出<strong>置换幅值时间序列</strong>。</li><li>通过计算<strong>原始相位时间序列</strong>和<strong>置换幅值时间序列</strong>(反之亦然)之间的耦合值来构造洗牌耦合值。</li><li>这种生成替代数据的方法是最保守的，因为除了所研究的相位角和幅值之间的时间关系，它保留了脑电图数据的所有特征，</li><li>洗牌通常重复200-1000次。</li><li>将观察到的耦合值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{observed}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> <strong>标准化</strong>为洗牌耦合值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{shuffled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 的分布，公式如下：</li></ol></li></ol><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right" columnspacing=""><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mi>z</mi></msub><mo>=</mo><mfrac><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub><mo>−</mo><mi>μ</mi><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><mrow><mi>σ</mi><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow></mfrac></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}CFC_{z} = \frac{CFC_{observed} - \mu CFC_{shuffled} }{\sigma CFC_{shuffled}} \end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.632438em;vertical-align:-1.066219em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.566219em;"><span style="top:-3.5662190000000002em;"><span class="pstrut" style="height:3.3603300000000003em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.36033em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord mathnormal">μ</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.972108em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.066219em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">CFC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span></span></span></span>为耦合值，$ \mu  $ 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{shuffled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 均值，$\sigma $ 为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{shuffled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span> 标准差。只有当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{observed}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02778em;">r</span><span class="mord mathnormal mtight" style="margin-right:0.03588em;">v</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 大于95%的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mrow><mi>s</mi><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">CFC_{shuffled}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.969438em;vertical-align:-0.286108em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361079999999999em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.286108em;"><span></span></span></span></span></span></span></span></span></span>时，才被定义为显著。因为z值等于1.64对应的p值为5%，所以当<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mi>F</mi><msub><mi>C</mi><mi>z</mi></msub></mrow><annotation encoding="application/x-tex">CFC_{z}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.07153em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.04398em;">z</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>的值大于1.64 才被定义为显著。</p><ol><li><strong>python代码实现</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">npnts = <span class="title function_">len</span>(eeg)</span><br><span class="line">n_iter = <span class="number">1000</span></span><br><span class="line">PLV_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line">MVL_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line">MI_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line"><span class="keyword">for</span> ni <span class="keyword">in</span> <span class="title function_">range</span>(n_iter):</span><br><span class="line">    cutpoint = random.<span class="title function_">randrange</span>(np.<span class="title function_">round</span>(npnts/<span class="number">10</span>), np.<span class="title function_">round</span>(npnts*<span class="number">.9</span>))</span><br><span class="line">    new_amp = np.<span class="title function_">concatenate</span>((amp[<span class="attr">cutpoint</span>:] , amp[:cutpoint]))</span><br><span class="line"></span><br><span class="line">    PLV_shuffled[ni] = <span class="title function_">PLV_CFC_WSH</span>(phase, new_amp)</span><br><span class="line">    MVL_shuffled[ni] = <span class="title function_">MVL_CFC_WSH</span>(phase, new_amp)</span><br><span class="line">    [<span class="variable constant_">MI</span>, meanAmp] = <span class="title function_">MI_CFC_WSH</span>(phase, new_amp, n_hist_bins)</span><br><span class="line">    MI_shuffled[ni] = <span class="variable constant_">MI</span></span><br><span class="line">    </span><br><span class="line">PLV_CFCz = (PLV_observed - np.<span class="title function_">mean</span>(PLV_shuffled))/np.<span class="title function_">std</span>(PLV_shuffled)</span><br><span class="line">MVL_CFCz = (MVL_observed- np.<span class="title function_">mean</span>(MVL_shuffled))/np.<span class="title function_">std</span>(MVL_shuffled)</span><br><span class="line">MI_CFCz = (MI_observed - np.<span class="title function_">mean</span>(MI_shuffled))/np.<span class="title function_">std</span>(MI_shuffled)</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;PLV_CFCz: &#x27;</span>,PLV_CFCz)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;MVL_CFCz: &#x27;</span>,MVL_CFCz)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;MI_CFCz: &#x27;</span>,MI_CFCz)</span><br></pre></td></tr></table></figure><h2 id="5-实例分析"><a class="markdownIt-Anchor" href="#5-实例分析"></a> 5、实例分析</h2><h3 id="51-模拟信号的cfc"><a class="markdownIt-Anchor" href="#51-模拟信号的cfc"></a> 5.1 模拟信号的CFC</h3><ol><li><strong>构建耦合信号</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">fs = <span class="number">1000</span>                            # sampling frequency (samples per second/<span class="title class_">Hz</span>) </span><br><span class="line">dt = <span class="number">1</span>/fs                           # seconds per sample </span><br><span class="line">stopTime = <span class="number">5</span>                        # length <span class="keyword">of</span> signal <span class="keyword">in</span> seconds </span><br><span class="line">t = np.<span class="title function_">arange</span>(<span class="number">0</span>, stopTime-dt, dt).<span class="property">T</span> # time vector <span class="keyword">in</span> seconds </span><br><span class="line">stopTime_plot = <span class="number">2</span>                   #limit time axis <span class="keyword">for</span> improved visualization </span><br><span class="line"></span><br><span class="line"># 生成调制后的信号</span><br><span class="line">f_P = <span class="number">4</span>       # 低频相位</span><br><span class="line">f_A = <span class="number">32</span>      # 高频幅度</span><br><span class="line">f_AM = <span class="number">0.5</span>    # f_AM表示振幅调制的频率</span><br><span class="line"><span class="title class_">Afp</span> = <span class="number">1</span>       # <span class="title class_">AfP</span>是固定的标量，决定<span class="variable constant_">SO</span>（慢波）的峰值振幅、</span><br><span class="line">K = <span class="number">2</span>         # K是固定的标量，决定<span class="variable constant_">FO</span>（快波）的峰值振幅、</span><br><span class="line">beta = <span class="number">0.3</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Xf</span>_P = <span class="title class_">Afp</span> * np.<span class="title function_">sin</span>(<span class="number">2</span> * np.<span class="property">pi</span> * f_P * t)       # 慢波（低频相位）</span><br><span class="line"><span class="title class_">Afa</span> = K * beta * np.<span class="title function_">sin</span>(<span class="number">2</span> * np.<span class="property">pi</span> * f_AM * t)  </span><br><span class="line"><span class="title class_">Xf</span>_A = <span class="title class_">Afa</span> * np.<span class="title function_">sin</span>(<span class="number">2</span> * np.<span class="property">pi</span> * f_A * t)       # 快波（高频振幅）</span><br><span class="line"></span><br><span class="line">signal = <span class="title class_">Xf</span>_A + <span class="title class_">Xf</span>_P</span><br></pre></td></tr></table></figure><ol start="2"><li><strong>计算CFC</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">phasefilt = <span class="title function_">filterFGx</span>(signal, fs, f_P, <span class="number">0.5</span>)</span><br><span class="line">phase = np.<span class="title function_">angle</span>(<span class="title function_">hilbert</span>(phasefilt))</span><br><span class="line"></span><br><span class="line">ampfilt = <span class="title function_">filterFGx</span>(signal, fs, f_A, <span class="number">20</span>)</span><br><span class="line">amp = np.<span class="title function_">abs</span>(<span class="title function_">hilbert</span>(ampfilt))**<span class="number">2</span></span><br><span class="line"></span><br><span class="line"># 计算观测<span class="variable constant_">CFC</span></span><br><span class="line">PLV_observed = <span class="title function_">PLV_CFC_WSH</span>(phase, amp)</span><br><span class="line">MVL_observed = <span class="title function_">MVL_CFC_WSH</span>(phase, amp)</span><br><span class="line">n_hist_bins = <span class="number">18</span></span><br><span class="line">[MI_observed, meanAmp] = <span class="title function_">MI_CFC_WSH</span>(phase, amp, n_hist_bins)</span><br><span class="line"></span><br><span class="line"># 置换检验，计算洗牌<span class="variable constant_">CFC</span></span><br><span class="line">npnts = <span class="title function_">len</span>(signal)</span><br><span class="line">n_iter = <span class="number">1000</span></span><br><span class="line">PLV_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line">MVL_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line">MI_shuffled = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line"><span class="keyword">for</span> ni <span class="keyword">in</span> <span class="title function_">range</span>(n_iter):</span><br><span class="line">    cutpoint = random.<span class="title function_">randrange</span>(np.<span class="title function_">round</span>(npnts/<span class="number">10</span>), np.<span class="title function_">round</span>(npnts*<span class="number">.9</span>))</span><br><span class="line">    new_amp = np.<span class="title function_">concatenate</span>((amp[<span class="attr">cutpoint</span>:] , amp[:cutpoint]))</span><br><span class="line"></span><br><span class="line">    PLV_shuffled[ni] = <span class="title function_">PLV_CFC_WSH</span>(phase, new_amp)</span><br><span class="line">    MVL_shuffled[ni] = <span class="title function_">MVL_CFC_WSH</span>(phase, new_amp)</span><br><span class="line">    [<span class="variable constant_">MI</span>, meanAmp] = <span class="title function_">MI_CFC_WSH</span>(phase, new_amp, n_hist_bins)</span><br><span class="line">    MI_shuffled[ni] = <span class="variable constant_">MI</span></span><br><span class="line">    </span><br><span class="line">PLV_CFCz = (PLV_observed - np.<span class="title function_">mean</span>(PLV_shuffled))/np.<span class="title function_">std</span>(PLV_shuffled)</span><br><span class="line">MVL_CFCz = (MVL_observed- np.<span class="title function_">mean</span>(MVL_shuffled))/np.<span class="title function_">std</span>(MVL_shuffled)</span><br><span class="line">MI_CFCz = (MI_observed - np.<span class="title function_">mean</span>(MI_shuffled))/np.<span class="title function_">std</span>(MI_shuffled)</span><br><span class="line"></span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;PLV_CFCz: &#x27;</span>,PLV_CFCz)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;MVL_CFCz: &#x27;</span>,MVL_CFCz)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;MI_CFCz: &#x27;</span>,MI_CFCz)</span><br></pre></td></tr></table></figure><h3 id="52-eeg信号的cfc"><a class="markdownIt-Anchor" href="#52-eeg信号的cfc"></a> 5.2 EEG信号的CFC</h3><ol><li><strong>加载EEG信号</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data = scipy.<span class="property">io</span>.<span class="title function_">loadmat</span>(<span class="string">&#x27;accumbens_eeg.mat&#x27;</span>)</span><br><span class="line">srate = <span class="number">1000</span></span><br><span class="line">npnts = <span class="title function_">len</span>(data)</span><br><span class="line">eeg = data[<span class="string">&#x27;eeg&#x27;</span>].<span class="title function_">reshape</span>(-<span class="number">1</span>)</span><br><span class="line">fig = plt.<span class="title function_">figure</span>(figsize=(<span class="number">10</span>, <span class="number">4</span>),dpi=<span class="number">600</span>)</span><br><span class="line">ax1 = fig.<span class="title function_">add_subplot</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>)  # 子图<span class="number">1</span></span><br><span class="line">ax1.<span class="title function_">plot</span>(eeg, label=<span class="string">&#x27;eeg_data&#x27;</span>)</span><br><span class="line">ax1.<span class="title function_">legend</span>()</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCybk7D"><img src="https://s1.ax1x.com/2023/07/05/pCybk7D.png" alt="pCybk7D.png" /></a></p><ol start="2"><li><strong>计算CFC</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># define frequencies <span class="keyword">for</span> phase and <span class="keyword">for</span> amplitude</span><br><span class="line">phas_freqs =  np.<span class="title function_">arange</span>(<span class="number">5</span>, <span class="number">20</span>, <span class="number">2</span>)</span><br><span class="line">ampl_freqs = np.<span class="title function_">arange</span>(<span class="number">30</span>, <span class="number">150</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"># number <span class="keyword">of</span> iterations used <span class="keyword">for</span> permutation testing</span><br><span class="line">n_iter = <span class="number">500</span></span><br><span class="line"></span><br><span class="line"># initialize output phase-amplitude matrix</span><br><span class="line">phaseamp = np.<span class="title function_">zeros</span>([<span class="title function_">len</span>(phas_freqs),<span class="title function_">len</span>(ampl_freqs)])</span><br><span class="line"></span><br><span class="line"># loop over frequencies <span class="keyword">for</span> phase</span><br><span class="line"><span class="keyword">for</span> lower_fi <span class="keyword">in</span> <span class="title function_">range</span>(<span class="title function_">len</span>(phas_freqs)):</span><br><span class="line">    </span><br><span class="line">    # get phase values</span><br><span class="line">    phasefilt = <span class="title function_">filterFGx</span>(eeg, srate, phas_freqs[lower_fi], phas_freqs[lower_fi]*<span class="number">.4</span>)</span><br><span class="line">    phase = np.<span class="title function_">angle</span>(<span class="title function_">hilbert</span>(phasefilt))</span><br><span class="line">    # phase = <span class="title function_">angle</span>(<span class="title function_">hilbert</span>(phasefilt))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> upper_fi <span class="keyword">in</span> <span class="title function_">range</span>(<span class="title function_">len</span>(ampl_freqs)):     </span><br><span class="line">        ampfilt = <span class="title function_">filterFGx</span>(eeg, srate, ampl_freqs[upper_fi], ampl_freqs[upper_fi]*<span class="number">.78</span>)</span><br><span class="line">        amplit = np.<span class="title function_">abs</span>(<span class="title function_">hilbert</span>(ampfilt))**<span class="number">2</span></span><br><span class="line">        </span><br><span class="line">        # calculate observed modulation <span class="title function_">index</span>(<span class="variable constant_">MVL</span>)</span><br><span class="line">        [modidx, _] = <span class="title function_">MI_CFC_WSH</span>(phase, amplit, <span class="number">30</span>)</span><br><span class="line">        </span><br><span class="line">        # now use permutation testing to get Z-value</span><br><span class="line">        bm = np.<span class="title function_">zeros</span>(n_iter)</span><br><span class="line">        <span class="keyword">for</span> bi <span class="keyword">in</span> range (n_iter):</span><br><span class="line">            cutpoint = random.<span class="title function_">randrange</span>(np.<span class="title function_">round</span>(npnts/<span class="number">10</span>), np.<span class="title function_">round</span>(npnts*<span class="number">.9</span>))</span><br><span class="line">            new_amp = np.<span class="title function_">concatenate</span>((amplit[<span class="attr">cutpoint</span>:] , amplit[:cutpoint]))</span><br><span class="line">            [mi, _] = <span class="title function_">MI_CFC_WSH</span>(phase, new_amp, <span class="number">30</span>)</span><br><span class="line">            bm[bi] = mi</span><br><span class="line">        # the value we use is the normalized distance away <span class="keyword">from</span> the mean <span class="keyword">of</span></span><br><span class="line">        # boot-strapped values</span><br><span class="line">        phaseamp[lower_fi, upper_fi] = (modidx - np.<span class="title function_">mean</span>(bm)) / np.<span class="title function_">std</span>(bm)</span><br></pre></td></tr></table></figure><ol start="3"><li><strong>可视化</strong></li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fig, ax = plt.<span class="title function_">subplots</span>()</span><br><span class="line"><span class="variable constant_">CFC_WSH</span> = ax.<span class="title function_">contourf</span>(phas_freqs, ampl_freqs, phaseamp.<span class="property">T</span>)</span><br><span class="line">cbar = fig.<span class="title function_">colorbar</span>(<span class="variable constant_">CFC_WSH</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCybinK"><img src="https://s1.ax1x.com/2023/07/05/pCybinK.jpg" alt="pCybinK.jpg" /></a></p><h2 id="参考文献"><a class="markdownIt-Anchor" href="#参考文献"></a> 参考文献</h2><p>[1] Li, C., et al., 2021. High-frequency hubs of the ictal cross-frequency coupling network predict surgical outcome in epilepsy patients. IEEE Transactions on Neural Systems and Rehabilitation Engineering, 29, pp.1290-1299. (2区)<br />[2] Salimpour, Y. and Anderson, W.S., 2019. Cross-frequency coupling based neuromodulation for treating neurological disorders. Frontiers in neuroscience, 13, p.125. (3区)<br />[3] Musaeus, C.S., et al., 2020. Electroencephalographic cross-frequency coupling as a sign of disease progression in patients with mild cognitive impairment: a pilot study. Frontiers in neuroscience, 14, p.790. (3区)<br />[4] Zhang, W., et al., 2023. Altered fronto-central theta-gamma coupling in major depressive disorder during auditory steady-state responses. Clinical Neurophysiology, 146, pp.65-76. (3区)<br />[5] Hülsemann, Mareike J., Ewald Naumann and Björn Rasch. 《Quantification of Phase-Amplitude Coupling in Neuronal Oscillations: Comparison of Phase-Locking Value, Mean Vector Length, Modulation Index, and Generalized-Linear-Modeling-Cross-Frequency-Coupling》. Frontiers in Neuroscience (2019). (3区)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;目的介绍跨频耦合的背景及常用的计算方法&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的介绍跨频耦合的背景及常用的计算方法&quot;&gt;&lt;/a&gt; 目的：介绍跨频耦合的背景及常用的计算方法&lt;/h1&gt;
&lt;h2 id=&quot;1-背景&quot;&gt;&lt;a class=</summary>
      
    
    
    
    <category term="EEG" scheme="https://weisihong9.github.io/categories/EEG/"/>
    
    
    <category term="CFC" scheme="https://weisihong9.github.io/tags/CFC/"/>
    
  </entry>
  
  <entry>
    <title>EEG_TopoMap</title>
    <link href="https://weisihong9.github.io/2023/07/03/EEG_TopoMap/"/>
    <id>https://weisihong9.github.io/2023/07/03/EEG_TopoMap/</id>
    <published>2023-07-02T16:00:00.000Z</published>
    <updated>2023-07-05T05:08:47.908Z</updated>
    
    <content type="html"><![CDATA[<h1 id="目的利用mne实现自定义矩阵大脑拓扑图的绘制"><a class="markdownIt-Anchor" href="#目的利用mne实现自定义矩阵大脑拓扑图的绘制"></a> 目的：利用MNE实现自定义矩阵大脑拓扑图的绘制</h1><h2 id="0-加载python库"><a class="markdownIt-Anchor" href="#0-加载python库"></a> 0、加载python库</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.<span class="property">pyplot</span> <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> mne</span><br><span class="line"></span><br><span class="line">%matplotlib qt</span><br></pre></td></tr></table></figure><h2 id="1-获取可用的电极布局系统"><a class="markdownIt-Anchor" href="#1-获取可用的电极布局系统"></a> 1、获取可用的电极布局系统</h2><p>在使用MNE进行EEG信号的可视化操作时，往往需要导入对应电极的位置信息，MNE中有内置的常见电极布局系统，通过调用下面指令进行导入：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mne.<span class="property">channels</span>.<span class="title function_">get_builtin_montages</span>()</span><br><span class="line"></span><br><span class="line"># <span class="attr">output</span>:</span><br><span class="line">[<span class="string">&#x27;standard_1005&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;standard_1020&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;standard_alphabetic&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;standard_postfixed&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;standard_prefixed&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;standard_primed&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi16&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi32&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi64&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi128&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi160&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;biosemi256&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;easycap-M1&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;easycap-M10&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;EGI_256&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-32&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-64_1.0&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-65_1.0&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-128&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-129&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-256&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;GSN-HydroCel-257&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;mgh60&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;mgh70&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;artinis-octamon&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;artinis-brite23&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;brainproducts-RNP-BA-128&#x27;</span>]</span><br></pre></td></tr></table></figure><p>从上面的输出可以看出，MNE中共有27个可用的电极布局系统，具体选择哪一个要看你采集数据时使用的脑电帽电极布局系统是哪个。</p><h2 id="2-利用mne自带的电极布局系统对矩阵进行通道定位"><a class="markdownIt-Anchor" href="#2-利用mne自带的电极布局系统对矩阵进行通道定位"></a> 2、利用MNE自带的电极布局系统对矩阵进行通道定位</h2><h3 id="21-加载脑地形图位置坐标并可视化"><a class="markdownIt-Anchor" href="#21-加载脑地形图位置坐标并可视化"></a> 2.1 加载脑地形图位置坐标并可视化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int32_montage = mne.<span class="property">channels</span>.<span class="title function_">make_standard_montage</span>(<span class="string">&#x27;biosemi32&#x27;</span>)</span><br><span class="line">int32_montage.<span class="title function_">plot</span>()</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCrODBT"><img src="https://s1.ax1x.com/2023/07/03/pCrODBT.png" alt="pCrODBT.png" /></a></p><h3 id="22-构建自定义32导联的字典导联名称与导联权重一一对应"><a class="markdownIt-Anchor" href="#22-构建自定义32导联的字典导联名称与导联权重一一对应"></a> 2.2 构建自定义32导联的字典，导联名称与导联权重一一对应</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">weight = &#123;<span class="string">&#x27;Fp1&#x27;</span>: <span class="number">0.31</span>, <span class="string">&#x27;AF3&#x27;</span>: -<span class="number">0.26</span>, <span class="string">&#x27;F7&#x27;</span>: <span class="number">1.22</span>, <span class="string">&#x27;F3&#x27;</span>: <span class="number">0.99</span>, <span class="string">&#x27;Fz&#x27;</span>: <span class="number">0.71</span>, <span class="string">&#x27;FC5&#x27;</span>: <span class="number">0.55</span>, <span class="string">&#x27;FC1&#x27;</span>: -<span class="number">1.19</span>, <span class="string">&#x27;T7&#x27;</span>: <span class="number">0.61</span>, <span class="string">&#x27;C3&#x27;</span>: -<span class="number">0.80</span>, <span class="string">&#x27;Cz&#x27;</span>: <span class="number">2.36</span>, <span class="string">&#x27;CP5&#x27;</span>: -<span class="number">0.74</span>, <span class="string">&#x27;CP1&#x27;</span>: <span class="number">0.72</span>, <span class="string">&#x27;P7&#x27;</span>: <span class="number">0.93</span>, <span class="string">&#x27;P3&#x27;</span>: <span class="number">0.38</span>, <span class="string">&#x27;Pz&#x27;</span>: <span class="number">1.07</span>, <span class="string">&#x27;PO3&#x27;</span>: -<span class="number">1.46</span>, <span class="string">&#x27;O1&#x27;</span>: -<span class="number">0.12</span>, <span class="string">&#x27;Oz&#x27;</span>: <span class="number">1.074</span>, <span class="string">&#x27;Fp2&#x27;</span>: <span class="number">1.04</span>, <span class="string">&#x27;AF4&#x27;</span>: -<span class="number">0.065</span>, <span class="string">&#x27;F4&#x27;</span>: -<span class="number">0.52</span>, <span class="string">&#x27;F8&#x27;</span>: <span class="number">0.37</span>, <span class="string">&#x27;FC2&#x27;</span>: <span class="number">1.30</span>, <span class="string">&#x27;FC6&#x27;</span>: <span class="number">0.94</span>, <span class="string">&#x27;C4&#x27;</span>: -<span class="number">1.11</span>, <span class="string">&#x27;T8&#x27;</span>: -<span class="number">0.16</span>, <span class="string">&#x27;CP2&#x27;</span>: <span class="number">1.82</span>, <span class="string">&#x27;CP6&#x27;</span>: <span class="number">0.41</span>, <span class="string">&#x27;P4&#x27;</span>: <span class="number">0.46</span>, <span class="string">&#x27;P8&#x27;</span>: <span class="number">0.99</span>, <span class="string">&#x27;PO4&#x27;</span>:<span class="number">0.15</span>, <span class="string">&#x27;O2&#x27;</span>:<span class="number">0.23</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="23-根据脑地形图导联顺序重构自定义矩阵注意"><a class="markdownIt-Anchor" href="#23-根据脑地形图导联顺序重构自定义矩阵注意"></a> 2.3 根据脑地形图导联顺序重构自定义矩阵（*注意）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 查看脑地形图矩阵导联位置</span><br><span class="line">sensor_data_32 = int32_montage.<span class="title function_">get_positions</span>()[<span class="string">&#x27;ch_pos&#x27;</span>]</span><br><span class="line">sensor_dataframe_32 = pd.<span class="title class_">DataFrame</span>(sensor_data_32).<span class="property">T</span></span><br><span class="line">chLa_index = sensor_dataframe_32.<span class="property">index</span>.<span class="property">values</span></span><br><span class="line"><span class="title function_">print</span>(chLa_index)</span><br><span class="line"></span><br><span class="line"># 重构自定义矩阵顺序</span><br><span class="line">reWeight = []</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="attr">chLa_index</span>:</span><br><span class="line">    val = weight[key]</span><br><span class="line">    reWeight.<span class="title function_">append</span>(val)</span><br></pre></td></tr></table></figure><h3 id="24-topomap可视化"><a class="markdownIt-Anchor" href="#24-topomap可视化"></a> 2.4 TopoMap可视化</h3><h4 id="241-创建info"><a class="markdownIt-Anchor" href="#241-创建info"></a> 2.4.1 创建info</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">info = mne.<span class="title function_">create_info</span>(</span><br><span class="line">        ch_names = chLa_index,</span><br><span class="line">        ch_types = [<span class="string">&#x27;eeg&#x27;</span>]*<span class="number">32</span>,   # 通道个数</span><br><span class="line">        sfreq = <span class="number">1000</span>)            # 采样频率</span><br><span class="line">info.<span class="title function_">set_montage</span>(int32_montage)</span><br></pre></td></tr></table></figure><h4 id="242-可视化"><a class="markdownIt-Anchor" href="#242-可视化"></a> 2.4.2 可视化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">im, cn = mne.<span class="property">viz</span>.<span class="title function_">plot_topomap</span>(reWeight, </span><br><span class="line">                              info, </span><br><span class="line">                              names = chLa_index.<span class="title function_">tolist</span>(),</span><br><span class="line">                              # vlim=(-<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">                             )</span><br><span class="line">plt.<span class="title function_">colorbar</span>(im)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCrO2C9"><img src="https://s1.ax1x.com/2023/07/03/pCrO2C9.png" alt="pCrO2C9.png" /></a></p><h2 id="3-自定义电极布局文件对矩阵进行通道定位"><a class="markdownIt-Anchor" href="#3-自定义电极布局文件对矩阵进行通道定位"></a> 3、自定义电极布局文件对矩阵进行通道定位</h2><p>假设我有一个64导联的帽子，根据实验需求，实验过程中我只选择中央区和顶叶区域的电极。<br />那么我们该如何根据自己选择的导联制定通道定位模版呢？<br />这里有两种方法：</p><p>第一种：自定义新的电极布局文件，文件只包含实验选择的导联。这个方法的目的是教会你如何制作自己的电极布局文件，实际绘制时建议选择第二种方法。</p><p>第二种：使用原来的电极布局文件，先对矩阵进行归一化，后将未被选择的导联值置为0</p><h2 id="4-第一种方法"><a class="markdownIt-Anchor" href="#4-第一种方法"></a> 4、第一种方法</h2><h3 id="41-下载标准的64通道电极布局系统坐标"><a class="markdownIt-Anchor" href="#41-下载标准的64通道电极布局系统坐标"></a> 4.1 下载标准的64通道电极布局系统坐标</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 读取<span class="variable constant_">MNE</span>中biosemi64电极位置信息</span><br><span class="line">biosemi_montage = mne.<span class="property">channels</span>.<span class="title function_">make_standard_montage</span>(<span class="string">&#x27;biosemi64&#x27;</span>)</span><br><span class="line">sensor_data_64 = biosemi_montage.<span class="title function_">get_positions</span>()[<span class="string">&#x27;ch_pos&#x27;</span>]</span><br><span class="line">sensor_dataframe_64 = pd.<span class="title class_">DataFrame</span>(sensor_data_64).<span class="property">T</span></span><br><span class="line">sensor_dataframe_64.<span class="title function_">to_excel</span>(<span class="string">&#x27;sensor_dataframe_64.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure><h3 id="42-根据下载文件选择实验选取的电极坐标保存为excel格式"><a class="markdownIt-Anchor" href="#42-根据下载文件选择实验选取的电极坐标保存为excel格式"></a> 4.2 根据下载文件，选择实验选取的电极坐标，保存为excel格式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 模仿下载的电极布局excel，自定义电极布局文件</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCyAlad"><img src="https://s1.ax1x.com/2023/07/05/pCyAlad.png" alt="pCyAlad.png" /></a></p><h3 id="43-加载自定义的excel文件制作自己的montage"><a class="markdownIt-Anchor" href="#43-加载自定义的excel文件制作自己的montage"></a> 4.3 加载自定义的excel文件，制作自己的montage</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">myStardart = pd.<span class="title function_">read_excel</span>(<span class="string">&#x27;mySensor_dataframe.xlsx&#x27;</span>, index_col=<span class="number">0</span>) # 读取自己的电极定位文件</span><br><span class="line">ch_names = np.<span class="title function_">array</span>(myStardart.<span class="property">index</span>)                              # 电极名称</span><br><span class="line">position = np.<span class="title function_">array</span>(myStardart)                                    # 电极坐标位置</span><br><span class="line">sensorPosition = <span class="title function_">dict</span>(<span class="title function_">zip</span>(ch_names, position))                     # 制定为字典的形式</span><br><span class="line">myMontage = mne.<span class="property">channels</span>.<span class="title function_">make_dig_montage</span>(ch_pos=sensorPosition)</span><br><span class="line">myMontage.<span class="title function_">plot</span>()</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCrOBuV"><img src="https://s1.ax1x.com/2023/07/03/pCrOBuV.png" alt="pCrOBuV.png" /></a></p><h3 id="44-自定义导联权重字典"><a class="markdownIt-Anchor" href="#44-自定义导联权重字典"></a> 4.4 自定义导联权重字典</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myWeight = &#123;<span class="string">&#x27;C1&#x27;</span>: <span class="number">0.31</span>, <span class="string">&#x27;C3&#x27;</span>: <span class="number">1.22</span>, <span class="string">&#x27;P6&#x27;</span>: <span class="number">0.71</span>, <span class="string">&#x27;P4&#x27;</span>: <span class="number">0.55</span>,<span class="string">&#x27;P2&#x27;</span>: -<span class="number">1.19</span>, <span class="string">&#x27;CP5&#x27;</span>: <span class="number">0.61</span>,</span><br><span class="line">            <span class="string">&#x27;CP3&#x27;</span>: -<span class="number">0.80</span>, <span class="string">&#x27;CP1&#x27;</span>: <span class="number">2.36</span>, <span class="string">&#x27;P1&#x27;</span>: -<span class="number">0.74</span>, <span class="string">&#x27;P3&#x27;</span>: <span class="number">0.72</span>,<span class="string">&#x27;P5&#x27;</span>: <span class="number">0.93</span>, <span class="string">&#x27;Pz&#x27;</span>: -<span class="number">1.46</span>, </span><br><span class="line">            <span class="string">&#x27;CPz&#x27;</span>: -<span class="number">0.12</span>, <span class="string">&#x27;Cz&#x27;</span>: <span class="number">1.074</span>,<span class="string">&#x27;C5&#x27;</span>:<span class="number">2.34</span>,<span class="string">&#x27;C2&#x27;</span>: <span class="number">1.04</span>, <span class="string">&#x27;C4&#x27;</span>: -<span class="number">0.065</span>, <span class="string">&#x27;C6&#x27;</span>: -<span class="number">0.52</span>, </span><br><span class="line">            <span class="string">&#x27;CP2&#x27;</span>: <span class="number">0.37</span>, <span class="string">&#x27;CP4&#x27;</span>: <span class="number">1.30</span>, <span class="string">&#x27;CP6&#x27;</span>: <span class="number">0.94</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="45-根据脑地形图导联顺序重构自定义矩阵注意"><a class="markdownIt-Anchor" href="#45-根据脑地形图导联顺序重构自定义矩阵注意"></a> 4.5 根据脑地形图导联顺序重构自定义矩阵（*注意）</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 查看脑地形图矩阵导联位置</span><br><span class="line">my_chLa_index = ch_names.<span class="title function_">tolist</span>()</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;脑地形图矩阵导联顺序:&#x27;</span>,my_chLa_index)</span><br><span class="line"></span><br><span class="line"># 重构自定义矩阵顺序</span><br><span class="line">reMyWeight = []</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="attr">my_chLa_index</span>:</span><br><span class="line">    val = myWeight[key]</span><br><span class="line">    reMyWeight.<span class="title function_">append</span>(val)</span><br></pre></td></tr></table></figure><h3 id="46-topomap可视化"><a class="markdownIt-Anchor" href="#46-topomap可视化"></a> 4.6 TopoMap可视化</h3><h4 id="461-创建info"><a class="markdownIt-Anchor" href="#461-创建info"></a> 4.6.1 创建info</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">myinfo = mne.<span class="title function_">create_info</span>(</span><br><span class="line">        ch_names = my_chLa_index,</span><br><span class="line">        ch_types = [<span class="string">&#x27;eeg&#x27;</span>]*<span class="number">21</span>,   # 通道个数</span><br><span class="line">        sfreq = <span class="number">1000</span>)            # 采样频率</span><br><span class="line">myinfo.<span class="title function_">set_montage</span>(myMontage)</span><br></pre></td></tr></table></figure><h4 id="462-可视化"><a class="markdownIt-Anchor" href="#462-可视化"></a> 4.6.2 可视化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">im, cn = mne.<span class="property">viz</span>.<span class="title function_">plot_topomap</span>(reMyWeight, </span><br><span class="line">                              myinfo, </span><br><span class="line">                              names = my_chLa_index,</span><br><span class="line">                              # vlim=(-<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">                             )</span><br><span class="line">plt.<span class="title function_">colorbar</span>(im)</span><br><span class="line">plt.<span class="title function_">title</span>(<span class="string">&#x27;My Montage&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCrOc4J"><img src="https://s1.ax1x.com/2023/07/03/pCrOc4J.png" alt="pCrOc4J.png" /></a></p><h2 id="5-第二种方法"><a class="markdownIt-Anchor" href="#5-第二种方法"></a> 5、第二种方法</h2><h3 id="51-读取标准的64通道电极布局系统坐标"><a class="markdownIt-Anchor" href="#51-读取标准的64通道电极布局系统坐标"></a> 5.1 读取标准的64通道电极布局系统坐标</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 读取<span class="variable constant_">MNE</span>中biosemi64电极位置信息</span><br><span class="line">biosemi_montage = mne.<span class="property">channels</span>.<span class="title function_">make_standard_montage</span>(<span class="string">&#x27;biosemi64&#x27;</span>)</span><br><span class="line">sensor_data_64 = biosemi_montage.<span class="title function_">get_positions</span>()[<span class="string">&#x27;ch_pos&#x27;</span>]</span><br><span class="line">sensor_dataframe_64 = pd.<span class="title class_">DataFrame</span>(sensor_data_64).<span class="property">T</span></span><br><span class="line">chLa_index_64 = sensor_dataframe_64.<span class="property">index</span>.<span class="property">values</span></span><br><span class="line">biosemi_montage.<span class="title function_">plot</span>()</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCyubh4"><img src="https://s1.ax1x.com/2023/07/05/pCyubh4.png" alt="pCyubh4.png" /></a></p><h3 id="52-构建自定义部分导联字典"><a class="markdownIt-Anchor" href="#52-构建自定义部分导联字典"></a> 5.2 构建自定义部分导联字典</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">myWeight = &#123;<span class="string">&#x27;C1&#x27;</span>: <span class="number">0.31</span>, <span class="string">&#x27;C3&#x27;</span>: <span class="number">1.22</span>, <span class="string">&#x27;P6&#x27;</span>: <span class="number">0.71</span>, <span class="string">&#x27;P4&#x27;</span>: <span class="number">0.55</span>,<span class="string">&#x27;P2&#x27;</span>: -<span class="number">1.19</span>, <span class="string">&#x27;CP5&#x27;</span>: <span class="number">0.61</span>,</span><br><span class="line">            <span class="string">&#x27;CP3&#x27;</span>: -<span class="number">0.80</span>, <span class="string">&#x27;CP1&#x27;</span>: <span class="number">2.36</span>, <span class="string">&#x27;P1&#x27;</span>: -<span class="number">0.74</span>, <span class="string">&#x27;P3&#x27;</span>: <span class="number">0.72</span>,<span class="string">&#x27;P5&#x27;</span>: <span class="number">0.93</span>, <span class="string">&#x27;Pz&#x27;</span>: -<span class="number">1.46</span>, </span><br><span class="line">            <span class="string">&#x27;CPz&#x27;</span>: -<span class="number">0.12</span>, <span class="string">&#x27;Cz&#x27;</span>: <span class="number">1.074</span>,<span class="string">&#x27;C5&#x27;</span>:<span class="number">2.34</span>,<span class="string">&#x27;C2&#x27;</span>: <span class="number">1.04</span>, <span class="string">&#x27;C4&#x27;</span>: -<span class="number">0.065</span>, <span class="string">&#x27;C6&#x27;</span>: -<span class="number">0.52</span>, </span><br><span class="line">            <span class="string">&#x27;CP2&#x27;</span>: <span class="number">0.37</span>, <span class="string">&#x27;CP4&#x27;</span>: <span class="number">1.30</span>, <span class="string">&#x27;CP6&#x27;</span>: <span class="number">0.94</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="53-对字典的值进行归一化"><a class="markdownIt-Anchor" href="#53-对字典的值进行归一化"></a> 5.3 对字典的值进行归一化</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">norMyWeiht = myWeight.<span class="title function_">copy</span>()</span><br><span class="line"># <span class="title class_">Step</span> <span class="number">1</span>: 获取需要归一化的值</span><br><span class="line">values = [v <span class="keyword">for</span> v <span class="keyword">in</span> norMyWeiht.<span class="title function_">values</span>()]</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Step</span> <span class="number">2</span>: 找到最小值和最大值</span><br><span class="line">min_value = <span class="title function_">min</span>(values)</span><br><span class="line">max_value = <span class="title function_">max</span>(values)</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Step</span> <span class="number">3</span>: 对值进行归一化计算</span><br><span class="line"><span class="keyword">for</span> key, value <span class="keyword">in</span> norMyWeiht.<span class="title function_">items</span>():</span><br><span class="line">    normalized_value = (value - min_value) / (max_value - min_value)</span><br><span class="line">    norMyWeiht[key] = normalized_value</span><br></pre></td></tr></table></figure><h3 id="54-根据脑地形图导联顺序重构标准化后的矩阵将未被选择的导联值置为0"><a class="markdownIt-Anchor" href="#54-根据脑地形图导联顺序重构标准化后的矩阵将未被选择的导联值置为0"></a> 5.4 根据脑地形图导联顺序重构标准化后的矩阵，将未被选择的导联值置为0</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;脑地形图矩阵导联顺序:&#x27;</span>,chLa_index_64)</span><br><span class="line"># 重构自定义矩阵顺序</span><br><span class="line">reNorMyWeight = []</span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="attr">chLa_index_64</span>:</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> <span class="attr">norMyWeiht</span>:</span><br><span class="line">        val = norMyWeiht[key]</span><br><span class="line">        reNorMyWeight.<span class="title function_">append</span>(val)</span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        reNorMyWeight.<span class="title function_">append</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><h3 id="55-topomap可视化"><a class="markdownIt-Anchor" href="#55-topomap可视化"></a> 5.5 TopoMap可视化</h3><h4 id="551-创建info"><a class="markdownIt-Anchor" href="#551-创建info"></a> 5.5.1 创建info</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">info = mne.<span class="title function_">create_info</span>(</span><br><span class="line">        ch_names = chLa_index_64.<span class="title function_">tolist</span>(),</span><br><span class="line">        ch_types = [<span class="string">&#x27;eeg&#x27;</span>]*<span class="title function_">len</span>(reNorMyWeight),   # 通道个数</span><br><span class="line">        sfreq = <span class="number">1000</span>)            # 采样频率</span><br><span class="line">info.<span class="title function_">set_montage</span>(biosemi_montage)</span><br></pre></td></tr></table></figure><h4 id="552-可视化"><a class="markdownIt-Anchor" href="#552-可视化"></a> 5.5.2 可视化</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">im, cn = mne.<span class="property">viz</span>.<span class="title function_">plot_topomap</span>(reNorMyWeight, </span><br><span class="line">                              info, </span><br><span class="line">                              names = chLa_index_64,</span><br><span class="line">                              cmap = <span class="string">&#x27;jet&#x27;</span></span><br><span class="line">                              # vlim=(-<span class="number">2</span>, <span class="number">2</span>)</span><br><span class="line">                             )</span><br><span class="line">plt.<span class="title function_">colorbar</span>(im)</span><br><span class="line">plt.<span class="title function_">title</span>(<span class="string">&#x27;My Montage&#x27;</span>)</span><br><span class="line">plt.<span class="title function_">show</span>()</span><br></pre></td></tr></table></figure><p><a href="https://imgse.com/i/pCyuO39"><img src="https://s1.ax1x.com/2023/07/05/pCyuO39.png" alt="pCyuO39.png" /></a></p><h2 id="6-代码下载"><a class="markdownIt-Anchor" href="#6-代码下载"></a> 6、代码下载</h2><p><a href="https://github.com/weisihong9/EEG_TopoMap.git">https://github.com/weisihong9/EEG_TopoMap.git</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;目的利用mne实现自定义矩阵大脑拓扑图的绘制&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的利用mne实现自定义矩阵大脑拓扑图的绘制&quot;&gt;&lt;/a&gt; 目的：利用MNE实现自定义矩阵大脑拓扑图的绘制&lt;/h1&gt;
&lt;h2 id=&quot;0-加载py</summary>
      
    
    
    
    <category term="EEG" scheme="https://weisihong9.github.io/categories/EEG/"/>
    
    <category term="BEAM" scheme="https://weisihong9.github.io/categories/EEG/BEAM/"/>
    
    
    <category term="BEAM" scheme="https://weisihong9.github.io/tags/BEAM/"/>
    
  </entry>
  
  <entry>
    <title>Using_Markdown_writing</title>
    <link href="https://weisihong9.github.io/2023/05/21/Using_Markdown_writing/"/>
    <id>https://weisihong9.github.io/2023/05/21/Using_Markdown_writing/</id>
    <published>2023-05-21T08:54:43.000Z</published>
    <updated>2024-05-15T02:29:43.598Z</updated>
    
    <content type="html"><![CDATA[<h1 id="自动添加目录"><a class="markdownIt-Anchor" href="#自动添加目录"></a> 自动添加目录</h1><p>在前头添加：toc: true<br />自动编号很烦，还不知道咋解决</p><h1 id="这是一级标题"><a class="markdownIt-Anchor" href="#这是一级标题"></a> 这是一级标题</h1><p>下面开始说明如何使用markdown进行写作</p><h2 id="这是二级标题"><a class="markdownIt-Anchor" href="#这是二级标题"></a> 这是二级标题</h2><p>这是正文<br />换一行？ （在上一行后面按两次空格，再回车就是换一行）</p><p>换一段（按两次换行就是换一段）</p><h3 id="0-各种符号"><a class="markdownIt-Anchor" href="#0-各种符号"></a> 0 各种符号</h3><hr /><p>横线隔开</p><hr /><ul><li>a</li><li>b</li><li>[X] c</li><li>[X] d<br /><code>标注</code></li></ul><h3 id="1-强调"><a class="markdownIt-Anchor" href="#1-强调"></a> 1 强调</h3><p><strong>加粗了: 前后各加两个*号</strong><br /><em>斜体：前后各加一个星号</em></p><h3 id="2-列表"><a class="markdownIt-Anchor" href="#2-列表"></a> 2 列表</h3><ol><li>自动编号：数字 + 点 + 空格即可</li><li>来一个二级标题<ol><li>按一下回车，再tab就行</li></ol></li><li>再来一个三级标题<ol><li>按回车，再按tab<ol><li>继续回车，再tab</li></ol></li></ol></li></ol><h3 id="3-插入图片图床上传图片"><a class="markdownIt-Anchor" href="#3-插入图片图床上传图片"></a> 3 插入图片：图床上传图片</h3><p>把图片先上传到<a href="https://imgse.com/cathyimage_">自己的图床</a>，然后复制生成的图片链接。<br />格式为：!+[图片名字]+(http:\……png)<br /><img src="https://s1.ax1x.com/2023/05/21/p9Ip0b9.png" alt="p9Ip0b9" /><br /><em>图片注释</em></p><p>或者：<br /><a href="https://imgse.com/i/p9Ipb28"><img src="https://s1.ax1x.com/2023/05/21/p9Ipb28.png" alt="p9Ipb28.png" /></a></p><h3 id="4-数学公式"><a class="markdownIt-Anchor" href="#4-数学公式"></a> 4 数学公式</h3><p class='katex-block'><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>x</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></munder><mfrac><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mi>x</mi></mfrac><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\lim_{x \to \infin}\frac{sin(x)}{x}=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.127em;vertical-align:-0.7em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.69444em;"><span style="top:-2.4em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">lim</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">x</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></span></p><p>在一段文字中插入公式: <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo><mi>lim</mi><mo>⁡</mo></mo><mrow><mi>x</mi><mo>→</mo><mi mathvariant="normal">∞</mi></mrow></msub><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\lim_{x \to \infin}f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop"><span class="mop">lim</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mrel mtight">→</span><span class="mord mtight">∞</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>, command + m 快捷键连按两次就可以生成4个美元符号然后输入公式</p><h3 id="5-表格"><a class="markdownIt-Anchor" href="#5-表格"></a> 5 表格</h3><table><thead><tr><th style="text-align:left">EMD</th><th style="text-align:center">HHT</th><th style="text-align:right">HHSA</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:center">2</td><td style="text-align:right">3</td></tr><tr><td style="text-align:left">左对其</td><td style="text-align:center">居中对齐</td><td style="text-align:right">右对齐</td></tr></tbody></table><p>调整编辑部分表格格式快捷键：<br />先选中表格内容，然后：Alt（fn+option） + shift + f</p><h3 id="6-插入链接"><a class="markdownIt-Anchor" href="#6-插入链接"></a> 6 插入链接</h3><p>复制网址，然后选中要给超链接的文字，直接：command + v 就行<br />这是一个laTex的<a href="https://www.latexlive.com/home">链接</a></p><h3 id="7-code"><a class="markdownIt-Anchor" href="#7-code"></a> 7 code</h3><p>英文的三个小点：1左边的那个键</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># <span class="string">``</span><span class="string">` javascript</span></span><br><span class="line"><span class="string"># `</span><span class="string">``</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> <span class="title class_">PyEMD</span> <span class="keyword">import</span> <span class="variable constant_">EMD</span></span><br><span class="line"><span class="keyword">import</span> matplotlib.<span class="property">pyplot</span> <span class="keyword">as</span> plt </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="8-导航"><a class="markdownIt-Anchor" href="#8-导航"></a> 8 导航</h3><p><a href="https://imgse.com/i/p9IpOKg"><img src="https://s1.ax1x.com/2023/05/21/p9IpOKg.png" alt="p9IpOKg.png" /></a></p><h3 id="9-将md文件导出为pdf"><a class="markdownIt-Anchor" href="#9-将md文件导出为pdf"></a> 9 将md文件导出为pdf</h3><ol><li>首先下载这个插件：Markdown Preview Enhanced</li><li>然后 command + shift + v 打开 Preview **.md 界面</li><li>最后在 Preview **.md 界面，右键，然后选中：Chrome(Puppeteer) --&gt; PDF  即可</li></ol><h3 id="10-这是该md文件的下载链接"><a class="markdownIt-Anchor" href="#10-这是该md文件的下载链接"></a> 10 这是该md文件的<a href="https://github.com/weisihong9/Markdown-Writing.git">下载链接</a>！</h3><p>下载</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;自动添加目录&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#自动添加目录&quot;&gt;&lt;/a&gt; 自动添加目录&lt;/h1&gt;
&lt;p&gt;在前头添加：toc: true&lt;br /&gt;
自动编号很烦，还不知道咋解决&lt;/p&gt;
&lt;h1 id=&quot;这是一级标题&quot;&gt;&lt;a </summary>
      
    
    
    
    
    <category term="Markdown" scheme="https://weisihong9.github.io/tags/Markdown/"/>
    
  </entry>
  
  <entry>
    <title>EMD</title>
    <link href="https://weisihong9.github.io/2023/05/21/EMD/"/>
    <id>https://weisihong9.github.io/2023/05/21/EMD/</id>
    <published>2023-05-20T16:58:43.000Z</published>
    <updated>2023-05-21T15:59:47.986Z</updated>
    
    <content type="html"><![CDATA[<h2 id="目的利用python自带的-pyemd-实现-经验模态分解emd"><a class="markdownIt-Anchor" href="#目的利用python自带的-pyemd-实现-经验模态分解emd"></a> 目的：利用python自带的 pyEMD 实现 经验模态分解（EMD）</h2><h3 id="1-加载python库"><a class="markdownIt-Anchor" href="#1-加载python库"></a> 1 加载python库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">from PyEMD import EMD</span><br><span class="line">import matplotlib.pyplot as plt</span><br></pre></td></tr></table></figure><h3 id="2-emd分解"><a class="markdownIt-Anchor" href="#2-emd分解"></a> 2 EMD分解</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成示例信号</span></span><br><span class="line">t = np.linspace(0, 1, 1000)</span><br><span class="line">signal = np.sin(5 * 2 * np.pi * t) + np.sin(10 * 2 * np.pi * t)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建EMD对象</span></span><br><span class="line">emd = EMD()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 执行EMD分解</span></span><br><span class="line">IMFs = emd(signal)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绘制分解后的IMFs</span></span><br><span class="line">plt.figure(figsize=(10, 6),dpi=600)</span><br><span class="line">plt.subplot(len(IMFs) + 1, 1, 1)</span><br><span class="line">plt.plot(t, signal, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Original Signal&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, IMF <span class="keyword">in</span> enumerate(IMFs):</span><br><span class="line">    plt.subplot(len(IMFs) + 1, 1, i + 2)</span><br><span class="line">    plt.plot(t, IMF, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;IMF %d&#x27;</span> % (i + 1))</span><br><span class="line">plt.tight_layout()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure><h3 id="3-结束"><a class="markdownIt-Anchor" href="#3-结束"></a> 3 结束</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;目的利用python自带的-pyemd-实现-经验模态分解emd&quot;&gt;&lt;a class=&quot;markdownIt-Anchor&quot; href=&quot;#目的利用python自带的-pyemd-实现-经验模态分解emd&quot;&gt;&lt;/a&gt; 目的：利用python自带的 pyEMD 实现</summary>
      
    
    
    
    <category term="Signal processing" scheme="https://weisihong9.github.io/categories/Signal-processing/"/>
    
    <category term="EMD" scheme="https://weisihong9.github.io/categories/Signal-processing/EMD/"/>
    
    
    <category term="EMD" scheme="https://weisihong9.github.io/tags/EMD/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://weisihong9.github.io/2023/05/20/hello-world/"/>
    <id>https://weisihong9.github.io/2023/05/20/hello-world/</id>
    <published>2023-05-20T10:35:24.631Z</published>
    <updated>2023-05-20T10:35:24.632Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="quick-start"><a class="markdownIt-Anchor" href="#quick-start"></a> Quick Start</h2><h3 id="create-a-new-post"><a class="markdownIt-Anchor" href="#create-a-new-post"></a> Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="run-server"><a class="markdownIt-Anchor" href="#run-server"></a> Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="generate-static-files"><a class="markdownIt-Anchor" href="#generate-static-files"></a> Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="deploy-to-remote-sites"><a class="markdownIt-Anchor" href="#deploy-to-remote-sites"></a> Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
